{% extends "base.html" %}

{% block title %}{% trans %}FRA Sentinel - Advanced Forest Rights Monitoring System{% endtrans %}{% endblock %}

{% block content %}
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link href="{{ url_for('static', filename='css/unified-buttons.css') }}" rel="stylesheet">
    <style>
    :root {
    /* Beautiful Green Gradient Color Palette */
    --primary-gradient: linear-gradient(135deg, #0d4f3c 0%, #1b5e20 25%, #2e7d32 50%, #4caf50 75%, #81c784 100%);
    --secondary-gradient: linear-gradient(135deg, #1b5e20 0%, #4caf50 100%);
    --success-gradient: linear-gradient(135deg, #2e7d32 0%, #81c784 100%);
    --warning-gradient: linear-gradient(135deg, #ff8f00 0%, #ffb74d 100%);
    --info-gradient: linear-gradient(135deg, #1b5e20 0%, #66bb6a 100%);
    --dark-gradient: linear-gradient(135deg, #0d4f3c 0%, #1b4332 100%);
    
    --surface-gradient: linear-gradient(135deg, #ffffff 0%, #f1f8e9 100%);
    --card-gradient: linear-gradient(135deg, #ffffff 0%, #f9fbe7 100%);
    --sidebar-gradient: linear-gradient(180deg, #ffffff 0%, #f1f8e9 50%, #e8f5e8 100%);
    
    --text-primary: #1a1a1a;
    --text-secondary: #2e7d32;
    --text-light: #4caf50;
    --border-color: #c8e6c9;
    --shadow: 0 8px 32px rgba(13, 79, 60, 0.08);
    --shadow-hover: 0 16px 48px rgba(13, 79, 60, 0.12);
    
    --border-radius: 16px;
    --border-radius-small: 12px;
    --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    
    --spacing-xs: 8px;
    --spacing-sm: 12px;
    --spacing-md: 16px;
    --spacing-lg: 24px;
    --spacing-xl: 32px;
    --spacing-xxl: 48px;
}
/* Top Navigation Bar Styles */
.top-navbar {
    background: linear-gradient(135deg, #0d4f3c 0%, #1b5e20 25%, #2e7d32 50%, #4caf50 75%, #81c784 100%);
    color: white;
    padding: 12px 24px;
    display: flex;
    align-items: center;
    justify-content: space-between;
    box-shadow: 0 4px 20px rgba(13, 79, 60, 0.3);
    position: sticky;
    top: 0;
    z-index: 1000;
    backdrop-filter: blur(10px);
}

.navbar-brand h1 {
    font-size: 1.8rem;
    font-weight: 700;
    margin: 0;
    text-shadow: 0 2px 4px rgba(0,0,0,0.3);
}

.navbar-center {
    flex: 1;
    display: flex;
    justify-content: center;
}

.nav-features {
    display: flex;
    gap: 8px;
}

.nav-btn {
    background: rgba(255,255,255,0.15);
    border: 1px solid rgba(255,255,255,0.2);
    color: white;
    padding: 8px 16px;
    border-radius: 20px;
    cursor: pointer;
    transition: all 0.3s ease;
    display: flex;
    align-items: center;
    gap: 6px;
    font-size: 0.9rem;
    font-weight: 500;
    backdrop-filter: blur(10px);
    text-decoration: none;
}

.nav-btn:hover {
    background: rgba(255,255,255,0.25);
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(0,0,0,0.2);
}

.nav-icon {
    font-size: 1.1rem;
}

.navbar-right {
    display: flex;
    align-items: center;
    gap: 16px;
}

.language-switcher select {
    background: rgba(255,255,255,0.15);
    border: 1px solid rgba(255,255,255,0.2);
    color: white;
    padding: 6px 12px;
    border-radius: 15px;
    font-size: 0.85rem;
    cursor: pointer;
    backdrop-filter: blur(10px);
}

.language-switcher select option {
    background: #1b5e20;
    color: white;
}

.user-profile {
    display: flex;
    align-items: center;
    gap: 8px;
    background: rgba(255,255,255,0.1);
    padding: 6px 12px;
    border-radius: 20px;
    cursor: pointer;
    transition: all 0.3s ease;
}

.user-profile:hover {
    background: rgba(255,255,255,0.2);
}

.profile-avatar {
    width: 32px;
    height: 32px;
    background: rgba(255,255,255,0.2);
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
}

.avatar-icon {
    font-size: 1.2rem;
}

.profile-info {
    display: flex;
    flex-direction: column;
    align-items: flex-start;
}

.profile-name {
    font-size: 0.9rem;
    font-weight: 600;
    line-height: 1;
}

.profile-role {
    font-size: 0.75rem;
    opacity: 0.8;
    line-height: 1;
}

.admin-dropdown {
    position: relative;
}

.admin-btn {
    background: rgba(255,255,255,0.15);
    border: 1px solid rgba(255,255,255,0.2);
    color: white;
    padding: 8px 16px;
    border-radius: 20px;
    cursor: pointer;
    transition: all 0.3s ease;
    display: flex;
    align-items: center;
    gap: 6px;
    font-size: 0.9rem;
    font-weight: 500;
    backdrop-filter: blur(10px);
}

.admin-btn:hover {
    background: rgba(255,255,255,0.25);
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(0,0,0,0.2);
}

.dropdown-arrow {
    font-size: 0.7rem;
    transition: transform 0.3s ease;
}

.admin-menu {
    position: absolute;
    top: 100%;
    right: 0;
    background: white;
    border-radius: 12px;
    box-shadow: 0 8px 32px rgba(0,0,0,0.15);
    min-width: 180px;
    padding: 8px 0;
    margin-top: 8px;
    opacity: 0;
    visibility: hidden;
    transform: translateY(-10px);
    transition: all 0.3s ease;
    z-index: 99999;
}

.admin-menu.show {
    opacity: 1;
    visibility: visible;
    transform: translateY(0);
}

.admin-item {
    display: flex;
    align-items: center;
    gap: 10px;
    padding: 10px 16px;
    color: #333;
    text-decoration: none;
    transition: all 0.2s ease;
    font-size: 0.9rem;
}

.admin-item:hover {
    background: #f0f9ff;
    color: #1b5e20;
}

.admin-divider {
    height: 1px;
    background: #e5e7eb;
    margin: 4px 0;
}

.logout-item {
    color: #dc2626;
}

.logout-item:hover {
    background: #fef2f2;
    color: #dc2626;
}

.logout-btn {
    background: rgba(255,255,255,0.15);
    border: 1px solid rgba(255,255,255,0.2);
    color: white;
    padding: 8px 16px;
    border-radius: 20px;
    text-decoration: none;
    transition: all 0.3s ease;
    display: flex;
    align-items: center;
    gap: 6px;
    font-size: 0.9rem;
    font-weight: 500;
    backdrop-filter: blur(10px);
}

.logout-btn:hover {
    background: rgba(255,255,255,0.25);
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(0,0,0,0.2);
}

/* Enhanced Green Theme Styles */
.header {
    background: linear-gradient(135deg, #0d4f3c 0%, #1b5e20 25%, #2e7d32 50%, #4caf50 75%, #81c784 100%);
    color: white;
    padding: var(--spacing-xl) var(--spacing-lg);
    text-align: center;
    position: relative;
    overflow: hidden;
    box-shadow: 0 8px 32px rgba(13, 79, 60, 0.2);
}

.header h1 {
    font-size: 3rem;
    font-weight: 700;
    margin: 0 0 var(--spacing-sm) 0;
    background: linear-gradient(45deg, #ffffff, #e8f5e8);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
    text-shadow: 0 2px 4px rgba(0,0,0,0.1);
    line-height: 1.2;
}

/* Green-themed buttons */
.control-button:hover {
    background: linear-gradient(135deg, #0d4f3c, #2e7d32);
    color: white;
    transform: translateX(2px);
}

.control-button.active {
    background: linear-gradient(135deg, #0d4f3c, #2e7d32);
    color: white;
    box-shadow: 0 2px 8px rgba(13, 79, 60, 0.3);
}

.tab-button.active {
    background: linear-gradient(135deg, #0d4f3c, #2e7d32);
    color: white;
    box-shadow: 0 4px 12px rgba(13, 79, 60, 0.2);
}

/* Green-themed village avatar */
.village-avatar {
    background: linear-gradient(135deg, #0d4f3c, #2e7d32);
    box-shadow: 0 4px 12px rgba(13, 79, 60, 0.3);
}

.village-avatar::after {
    background: linear-gradient(135deg, #0d4f3c, #2e7d32);
}

/* Green-themed stat values */
.stat-value {
    background: linear-gradient(135deg, #0d4f3c, #2e7d32);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
}

.village-details h3 {
    background: linear-gradient(135deg, #0d4f3c, #2e7d32);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
}

.scheme-name {
    background: linear-gradient(135deg, #0d4f3c, #2e7d32);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
}

.section-icon {
    background: linear-gradient(135deg, #0d4f3c, #2e7d32);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
}

/* Green-themed chatbot */
.chatbot-fab {
    background: linear-gradient(135deg, #0d4f3c, #2e7d32);
    box-shadow: 0 8px 32px rgba(13, 79, 60, 0.3);
}

.chatbot-fab:hover {
    box-shadow: 0 12px 40px rgba(13, 79, 60, 0.4);
}

.chatbot-header {
    background: linear-gradient(135deg, #0d4f3c, #2e7d32);
}

.bot-message .message-avatar {
    background: linear-gradient(135deg, #0d4f3c, #2e7d32);
}

.suggestion-btn {
    background: linear-gradient(135deg, #0d4f3c, #2e7d32);
    box-shadow: 0 2px 8px rgba(13, 79, 60, 0.2);
}

.suggestion-btn:hover {
    box-shadow: 0 4px 12px rgba(13, 79, 60, 0.3);
}

.chatbot-send-btn {
    background: linear-gradient(135deg, #0d4f3c, #2e7d32);
}

.chatbot-send-btn:hover {
    box-shadow: 0 4px 16px rgba(13, 79, 60, 0.3);
}

/* Green-themed priority badges */
.priority-high { 
    background: linear-gradient(135deg, #d32f2f, #f44336); 
    color: white; 
}
.priority-medium { 
    background: linear-gradient(135deg, #f57c00, #ff9800); 
    color: white; 
}
.priority-low { 
    background: linear-gradient(135deg, #2e7d32, #4caf50); 
    color: white; 
}

/* Green-themed score bars */
.score-fill {
    background: linear-gradient(135deg, #2e7d32, #4caf50);
}

.score-value {
    background: linear-gradient(135deg, #0d4f3c, #2e7d32);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
}

/* Green-themed reason items */
.reason-item {
    background: linear-gradient(135deg, #e8f5e8, #f1f8e9);
    border-left: 4px solid #2e7d32;
}

.reason-check {
    color: #2e7d32;
}

/* Green-themed borders and accents */
.info-section::before {
    background: linear-gradient(135deg, #0d4f3c, #2e7d32);
}

.village-card::before {
    background: linear-gradient(135deg, #0d4f3c, #2e7d32);
}

.recommendation-item::before {
    background: linear-gradient(135deg, #0d4f3c, #2e7d32);
}

.stat-item:hover::before {
    background: linear-gradient(135deg, #0d4f3c, #2e7d32);
}

/* Green-themed map markers */
.leaflet-marker-icon {
    filter: hue-rotate(120deg);
}

/* Custom scrollbar with green theme */
::-webkit-scrollbar-thumb {
    background: linear-gradient(135deg, #0d4f3c, #2e7d32);
}

::-webkit-scrollbar-thumb:hover {
    background: linear-gradient(135deg, #1b5e20, #4caf50);
}


    
    * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
    }
    
    body {
        font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
        background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
        color: var(--text-primary);
        line-height: 1.6;
        overflow-x: hidden;
    }
    
    /* Perfect Header Alignment */
    .header {
        background: var(--primary-gradient);
        color: white;
        padding: var(--spacing-xl) var(--spacing-lg);
        text-align: center;
        position: relative;
        overflow: hidden;
        box-shadow: 0 8px 32px rgba(0,0,0,0.1);
    }
    
    .header::before {
        content: '';
        position: absolute;
        top: 0;
        left: -100%;
        width: 100%;
        height: 100%;
        background: linear-gradient(90deg, transparent, rgba(255,255,255,0.1), transparent);
        animation: shimmer 3s infinite;
    }
    
    @keyframes shimmer {
        0% { left: -100%; }
        100% { left: 100%; }
    }
    
    .header-content {
        position: relative;
        z-index: 2;
        max-width: 1200px;
        margin: 0 auto;
    }
    
    .header h1 {
        font-size: 3rem;
        font-weight: 700;
        margin: 0 0 var(--spacing-sm) 0;
        background: linear-gradient(45deg, #ffffff, #e3f2fd);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
        text-shadow: 0 2px 4px rgba(0,0,0,0.1);
        line-height: 1.2;
    }
    
    .header p {
        font-size: 1.25rem;
        opacity: 0.95;
        font-weight: 400;
        margin: 0;
    }
    
    /* Perfect Container Layout */
    .container {
        display: grid;
        grid-template-columns: 420px 1fr;
        gap: var(--spacing-lg);
        min-height: calc(100vh - 140px);
        padding: var(--spacing-lg);
        max-width: 1600px;
        margin: 0 auto;
        align-items: start;
    }
    
    /* Perfect Sidebar Alignment */
    .sidebar {
        background: var(--sidebar-gradient);
        border-radius: var(--border-radius);
        box-shadow: var(--shadow);
        overflow: hidden;
        transition: var(--transition);
        border: 1px solid var(--border-color);
        height: fit-content;
        position: sticky;
        top: var(--spacing-lg);
    }
    
    .sidebar:hover {
        transform: translateY(-2px);
        box-shadow: var(--shadow-hover);
    }
    
    /* Perfect Map Container */
    .map-container {
        background: var(--card-gradient);
        border-radius: var(--border-radius);
        box-shadow: var(--shadow);
        overflow: hidden;
        position: relative;
        border: 1px solid var(--border-color);
        min-height: calc(100vh - 180px);
        height: calc(100vh - 180px);
    }
    
    #map {
        height: 100%;
        width: 100%;
    }
    
    /* Perfect Layer Controls Alignment */
    .map-controls {
        position: absolute;
        bottom: var(--spacing-md);
        right: var(--spacing-md);
        z-index: 1000;
        display: flex;
        flex-direction: column;
        gap: var(--spacing-sm);
    }
    
    .control-group {
        background: var(--surface-gradient);
        border-radius: var(--border-radius-small);
        padding: var(--spacing-xs);
        box-shadow: 0 4px 20px rgba(0,0,0,0.1);
        border: 1px solid var(--border-color);
        backdrop-filter: blur(10px);
        display: flex;
        flex-direction: column;
        gap: 4px;
    }
    
    .control-button {
        display: flex;
        align-items: center;
        gap: var(--spacing-xs);
        background: transparent;
        border: none;
        border-radius: var(--spacing-xs);
        padding: var(--spacing-sm) var(--spacing-md);
        cursor: pointer;
        font-size: 0.9rem;
        font-weight: 500;
        transition: var(--transition);
        color: var(--text-primary);
        white-space: nowrap;
        min-width: 120px;
        justify-content: flex-start;
    }
    
    .control-button:hover {
        background: var(--primary-gradient);
        color: white;
        transform: translateX(2px);
    }
    
    .control-button.active {
        background: var(--primary-gradient);
        color: white;
        box-shadow: 0 2px 8px rgba(30, 60, 114, 0.3);
    }
    
    .control-icon {
        font-size: 1.1em;
        width: 20px;
        text-align: center;
    }
    
    /* Perfect Tab Navigation */
    .tab-navigation {
        display: grid;
        grid-template-columns: repeat(3, 1fr);
        background: var(--surface-gradient);
        border-bottom: 1px solid var(--border-color);
        padding: 6px;
        gap: 4px;
    }
    
    .tab-button {
        padding: var(--spacing-md) var(--spacing-sm);
        border: none;
        background: transparent;
        cursor: pointer;
        transition: var(--transition);
        font-weight: 500;
        font-size: 0.95rem;
        color: var(--text-secondary);
        border-radius: var(--spacing-xs);
        display: flex;
        align-items: center;
        justify-content: center;
        gap: var(--spacing-xs);
        text-align: center;
    }
    
    .tab-button:hover {
        background: rgba(255,255,255,0.7);
        color: var(--text-primary);
    }
    
    .tab-button.active {
        background: var(--primary-gradient);
        color: white;
        box-shadow: 0 4px 12px rgba(30, 60, 114, 0.2);
    }

    .breadcrumb-nav {
        display: flex;
        align-items: center;
        gap: 8px;
        margin-bottom: 20px;
        padding: 10px;
        background: rgba(255, 255, 255, 0.9);
        border-radius: 8px;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
    }

    .breadcrumb-item {
        padding: 5px 10px;
        border-radius: 15px;
        cursor: pointer;
        transition: all 0.3s ease;
        font-size: 0.9rem;
    }

    .breadcrumb-item:hover {
        background: var(--primary-gradient);
        color: white;
    }

    .breadcrumb-item.active {
        background: var(--primary-gradient);
        color: white;
    }

    .breadcrumb-item::after {
        content: " ‚Üí ";
        margin-left: 8px;
        color: #666;
    }

    .breadcrumb-item:last-child::after {
        content: "";
    }

    .progress-stats {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 15px;
        margin-bottom: 20px;
    }

    .stacked-bars {
        background: rgba(255, 255, 255, 0.9);
        padding: 20px;
        border-radius: 10px;
        margin-bottom: 20px;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
    }

    .top-pending {
        background: rgba(255, 255, 255, 0.9);
        padding: 20px;
        border-radius: 10px;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
    }

    .top-pending h4 {
        margin: 0 0 15px 0;
        color: var(--text-primary);
        font-size: 1.1rem;
    }

    .pending-list {
        max-height: 300px;
        overflow-y: auto;
    }

    .pending-item {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 10px;
        border-bottom: 1px solid #eee;
        cursor: pointer;
        transition: background 0.3s ease;
    }

    .pending-item:hover {
        background: rgba(13, 79, 60, 0.1);
    }

    .pending-item:last-child {
        border-bottom: none;
    }

    .pending-village {
        font-weight: 500;
        color: var(--text-primary);
    }

    .pending-count {
        background: var(--primary-gradient);
        color: white;
        padding: 4px 8px;
        border-radius: 12px;
        font-size: 0.8rem;
        font-weight: 600;
    }

    .resources-btn {
        position: fixed;
        top: 20px;
        right: 20px;
        background: var(--primary-gradient);
        color: white;
        border: none;
        padding: 12px 20px;
        border-radius: 25px;
        cursor: pointer;
        font-size: 1rem;
        font-weight: 600;
        box-shadow: 0 4px 15px rgba(13, 79, 60, 0.3);
        transition: all 0.3s ease;
        z-index: 1000;
    }

    .resources-btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 6px 20px rgba(13, 79, 60, 0.4);
    }

    .resources-drawer {
        position: fixed;
        top: 0;
        right: -400px;
        width: 400px;
        height: 100vh;
        background: white;
        box-shadow: -5px 0 20px rgba(0, 0, 0, 0.1);
        transition: right 0.3s ease;
        z-index: 1001;
        overflow-y: auto;
    }

    .resources-drawer.open {
        right: 0;
    }

    .drawer-header {
        background: var(--primary-gradient);
        color: white;
        padding: 20px;
        display: flex;
        justify-content: space-between;
        align-items: center;
    }

    .drawer-header h3 {
        margin: 0;
        font-size: 1.2rem;
    }

    .close-drawer {
        background: none;
        border: none;
        color: white;
        font-size: 1.5rem;
        cursor: pointer;
        padding: 5px;
        border-radius: 50%;
        width: 30px;
        height: 30px;
        display: flex;
        align-items: center;
        justify-content: center;
    }

    .close-drawer:hover {
        background: rgba(255, 255, 255, 0.2);
    }

    .drawer-content {
        padding: 20px;
    }

    .resource-section {
        margin-bottom: 25px;
    }

    .resource-section h4 {
        color: var(--text-primary);
        margin: 0 0 15px 0;
        font-size: 1.1rem;
        border-bottom: 2px solid var(--border-color);
        padding-bottom: 8px;
    }

    .resource-links {
        display: flex;
        flex-direction: column;
        gap: 10px;
    }

    .resource-link {
        display: flex;
        align-items: center;
        gap: 12px;
        padding: 12px;
        background: rgba(13, 79, 60, 0.05);
        border-radius: 8px;
        text-decoration: none;
        color: var(--text-primary);
        transition: all 0.3s ease;
        border: 1px solid transparent;
    }

    .resource-link:hover {
        background: rgba(13, 79, 60, 0.1);
        border-color: var(--border-color);
        transform: translateX(5px);
    }

    .link-icon {
        font-size: 1.5rem;
        width: 30px;
        text-align: center;
    }

    .link-content strong {
        display: block;
        font-size: 0.95rem;
        margin-bottom: 2px;
    }

    .link-content small {
        color: var(--text-secondary);
        font-size: 0.8rem;
    }

    .contact-list {
        display: flex;
        flex-direction: column;
        gap: 12px;
    }

    .contact-item {
        padding: 12px;
        background: rgba(13, 79, 60, 0.05);
        border-radius: 8px;
        border-left: 4px solid var(--primary-color);
    }

    .contact-item strong {
        display: block;
        color: var(--text-primary);
        margin-bottom: 8px;
        font-size: 0.95rem;
    }

    .contact-details {
        display: flex;
        flex-direction: column;
        gap: 4px;
    }

    .contact-details span {
        font-size: 0.85rem;
        color: var(--text-secondary);
    }

    .compliance-note {
        background: rgba(13, 79, 60, 0.1);
        padding: 15px;
        border-radius: 8px;
        border-left: 4px solid var(--primary-color);
        margin-top: 20px;
    }

    .compliance-note p {
        margin: 0 0 8px 0;
        font-size: 0.9rem;
        line-height: 1.4;
    }

    .compliance-note p:last-child {
        margin-bottom: 0;
    }

    .compliance-note-atlas {
        position: fixed;
        bottom: 20px;
        left: 20px;
        background: rgba(13, 79, 60, 0.1);
        padding: 8px 15px;
        border-radius: 15px;
        border-left: 3px solid #0d4f3c;
        z-index: 1000;
    }

    .compliance-note-atlas small {
        color: #0d4f3c;
        font-weight: 500;
        font-size: 0.85rem;
    }

    .mpr-snapshot-card {
        position: fixed;
        bottom: 20px;
        right: 20px;
        background: rgba(255, 255, 255, 0.95);
        padding: 15px;
        border-radius: 8px;
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        backdrop-filter: blur(10px);
        z-index: 1000;
        max-width: 300px;
    }

    .mpr-snapshot-card h4 {
        margin: 0 0 10px 0;
        color: #0d4f3c;
        font-size: 1rem;
    }

    .mpr-snapshot-card p {
        margin: 5px 0;
        font-size: 0.9rem;
        color: #666;
    }

    .refresh-btn {
        background: #0d4f3c;
        color: white;
        border: none;
        padding: 5px 10px;
        border-radius: 4px;
        cursor: pointer;
        font-size: 0.8rem;
        margin-top: 10px;
    }

    .refresh-btn:hover {
        background: #1b5e20;
    }
    
    /* Perfect Tab Content */
    .tab-content {
        padding: var(--spacing-lg);
        max-height: calc(100vh - 280px);
        overflow-y: auto;
        display: flex;
        flex-direction: column;
        gap: var(--spacing-lg);
    }
    
    .tab-pane {
        display: none;
    }
    
    .tab-pane.active {
        display: flex;
        flex-direction: column;
        gap: var(--spacing-lg);
        animation: fadeInUp 0.5s ease;
    }
    
    @keyframes fadeInUp {
        from {
            opacity: 0;
            transform: translateY(20px);
        }
        to {
            opacity: 1;
            transform: translateY(0);
        }
    }
    
    /* Perfect Info Section Alignment */
   .info-section {
    padding: var(--spacing-md);
    background: var(--card-gradient);
    border-radius: var(--border-radius-small);
    border: 1px solid var(--border-color);
    box-shadow: 0 2px 12px rgba(0,0,0,0.04);
    transition: var(--transition);
    position: relative;
    overflow: hidden;
    margin-bottom: var(--spacing-md);
}

    .info-section::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        height: 4px;
        background: var(--primary-gradient);
        border-radius: var(--border-radius) var(--border-radius) 0 0;
    }
    
    .info-section:hover {
        transform: translateY(-1px);
        box-shadow: 0 8px 30px rgba(0,0,0,0.06);
    }
    
  .info-section h3 {
    color: var(--text-primary);
    font-weight: 600;
    font-size: 1.1rem;
    margin: 0 0 var(--spacing-sm) 0;
    display: flex;
    align-items: center;
    gap: var(--spacing-xs);
    line-height: 1.2;
}

.section-icon {
    font-size: 1.2em;
    background: var(--primary-gradient);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
    width: 20px;
    text-align: center;
}

    
   
    
    /* Perfect Stat Items Grid */
    .stats-grid {
        display: grid;
        gap: var(--spacing-sm);
        grid-template-columns: 1fr;
    }
    
.stat-item {
    display: grid;
    grid-template-columns: 1fr auto;
    align-items: center;
    gap: var(--spacing-sm);
    padding: var(--spacing-sm) var(--spacing-md);
    background: var(--surface-gradient);
    border-radius: var(--spacing-xs);
    border: 1px solid var(--border-color);
    transition: var(--transition);
    position: relative;
    overflow: hidden;
    min-height: 44px;
}

    .stat-item::before {
        content: '';
        position: absolute;
        left: 0;
        top: 0;
        bottom: 0;
        width: 0;
        background: var(--primary-gradient);
        transition: width 0.3s ease;
    }
    
    .stat-item:hover::before {
        width: 4px;
    }
    
    .stat-item:hover {
        transform: translateX(4px);
        box-shadow: 0 4px 20px rgba(0,0,0,0.06);
    }
    
  .stat-label {
    display: flex;
    align-items: center;
    gap: var(--spacing-xs);
    font-weight: 500;
    color: var(--text-primary);
    font-size: 0.85rem;
}

.stat-icon {
    font-size: 1.1em;
    width: 18px;
    text-align: center;
}

.stat-value-container {
    text-align: right;
    display: flex;
    flex-direction: column;
    gap: 2px;
    align-items: flex-end;
}

.stat-value {
    font-weight: 600;
    font-size: 1rem;
    background: var(--primary-gradient);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
    line-height: 1.1;
}

.stat-subtext {
    font-size: 0.7rem;
    color: var(--text-light);
    margin: 0;
}

       
    /* Perfect Loading Animation */
    .loading {
        display: flex;
        align-items: center;
        justify-content: center;
        gap: var(--spacing-sm);
        padding: var(--spacing-xxl);
        color: var(--text-secondary);
        font-style: italic;
        font-size: 0.95rem;
    }
    
    .loading::before {
        content: '';
        width: 24px;
        height: 24px;
        border: 3px solid var(--border-color);
        border-top: 3px solid transparent;
        border-radius: 50%;
        animation: spin 1s linear infinite;
        background: conic-gradient(from 0deg, transparent, #667eea);
    }
    
    @keyframes spin {
        0% { transform: rotate(0deg); }
        100% { transform: rotate(360deg); }
    }
    
    /* Perfect Village Card */
  .village-card {
    background: var(--card-gradient);
    border-radius: var(--border-radius-small);
    padding: var(--spacing-md);
    border: 1px solid var(--border-color);
    box-shadow: 0 4px 16px rgba(0,0,0,0.04);
    position: relative;
    overflow: hidden;
}

    
    .village-card::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        height: 6px;
        background: var(--primary-gradient);
    }
    
   .village-header {
    display: grid;
    grid-template-columns: auto 1fr;
    gap: var(--spacing-sm);
    align-items: center;
    margin-bottom: var(--spacing-md);
}

    .village-avatar {
    width: 48px;
    height: 48px;
    background: var(--primary-gradient);
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 1.4rem;
    color: white;
    box-shadow: 0 4px 12px rgba(30, 60, 114, 0.25);
    flex-shrink: 0;
}

    
    .village-avatar::after {
        content: '';
        position: absolute;
        top: -2px;
        left: -2px;
        right: -2px;
        bottom: -2px;
        background: var(--primary-gradient);
        border-radius: 50%;
        z-index: -1;
        animation: pulse 2s infinite;
    }
    
    @keyframes pulse {
        0%, 100% { transform: scale(1); opacity: 1; }
        50% { transform: scale(1.02); opacity: 0.9; }
    }
    
   .village-details h3 {
    margin: 0 0 2px 0;
    font-size: 1.2rem;
    font-weight: 600;
    background: var(--primary-gradient);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
    line-height: 1.2;
}

.village-details p {
    margin: 0;
    color: var(--text-secondary);
    font-size: 0.85rem;
    font-weight: 400;
}

    
    
    .village-stats {
        display: grid;
        gap: var(--spacing-sm);
    }
    
    /* Perfect Recommendations */
  .recommendation-item {
    background: var(--card-gradient);
    padding: var(--spacing-md);
    border-radius: var(--border-radius-small);
    border: 1px solid var(--border-color);
    box-shadow: 0 4px 16px rgba(0,0,0,0.04);
    transition: var(--transition);
    position: relative;
    overflow: hidden;
    margin-bottom: var(--spacing-sm);
}

    
    .recommendation-item::before {
        content: '';
        position: absolute;
        left: 0;
        top: 0;
        bottom: 0;
        width: 6px;
        background: var(--primary-gradient);
    }
    
    .recommendation-item:hover {
        transform: translateY(-2px) translateX(2px);
        box-shadow: 0 16px 48px rgba(0,0,0,0.08);
    }
    
    .scheme-header {
        display: grid;
        grid-template-columns: 1fr auto;
        gap: var(--spacing-md);
        align-items: start;
        margin-bottom: var(--spacing-md);
    }
    
    .scheme-name {
        font-weight: 700;
        font-size: 1.3rem;
        background: var(--primary-gradient);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
        display: flex;
        align-items: center;
        gap: var(--spacing-sm);
        line-height: 1.3;
    }
    
    .scheme-icon {
        font-size: 1.2em;
        width: 24px;
        text-align: center;
    }
    
    .priority {
        padding: var(--spacing-xs) var(--spacing-md);
        border-radius: 20px;
        font-size: 0.8rem;
        font-weight: 600;
        text-transform: uppercase;
        letter-spacing: 0.5px;
        border: none;
        color: white;
        white-space: nowrap;
    }
    
    .priority-high { background: var(--warning-gradient); }
    .priority-medium { background: var(--info-gradient); }
    .priority-low { background: var(--success-gradient); }
    
    .scheme-content {
        display: grid;
        gap: var(--spacing-md);
    }
    
    .scheme-details {
        color: var(--text-secondary);
        line-height: 1.6;
    }
    
    .scheme-details p {
        margin: var(--spacing-xs) 0;
    }
    
    .scheme-details strong {
        color: var(--text-primary);
    }
    
    .eligibility-reasons {
        display: grid;
        gap: var(--spacing-xs);
    }
    
    .reason-item {
        display: flex;
        align-items: center;
        gap: var(--spacing-sm);
        padding: var(--spacing-sm) var(--spacing-md);
        background: linear-gradient(135deg, #e8f5e8, #f1f8e9);
        border-radius: var(--spacing-xs);
        border-left: 4px solid #4caf50;
    }
    
    .reason-check {
        color: #4caf50;
        font-weight: 600;
        font-size: 1.1em;
    }
    
    .eligibility-score {
        display: grid;
        grid-template-columns: auto 1fr auto;
        gap: var(--spacing-sm);
        align-items: center;
        font-size: 0.95rem;
        margin-top: var(--spacing-md);
    }
    
    .score-label {
        font-weight: 600;
        color: var(--text-primary);
    }
    
    .score-bar {
        height: 10px;
        background: var(--border-color);
        border-radius: 5px;
        overflow: hidden;
        position: relative;
    }
    
    .score-fill {
        height: 100%;
        background: var(--success-gradient);
        transition: width 2s ease;
        border-radius: 5px;
    }
    
    .score-value {
        font-weight: 700;
        background: var(--primary-gradient);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
    }
    
    /* Perfect Status Display */
    .debug-status {
        position: fixed;
        bottom: var(--spacing-lg);
        right: var(--spacing-lg);
        background: var(--dark-gradient);
        color: white;
        padding: var(--spacing-sm) var(--spacing-md);
        border-radius: var(--border-radius-small);
        font-size: 0.85rem;
        font-weight: 500;
        z-index: 10000;
        max-width: 320px;
        box-shadow: 0 8px 32px rgba(0,0,0,0.25);
        backdrop-filter: blur(10px);
        border: 1px solid rgba(255,255,255,0.1);
    }
    
    /* Perfect Chatbot Styles */
    .chatbot-fab {
        position: fixed;
        bottom: var(--spacing-lg);
        left: var(--spacing-lg);
        width: 64px;
        height: 64px;
        background: var(--primary-gradient);
        border: none;
        border-radius: 50%;
        color: white;
        font-size: 1.8rem;
        cursor: pointer;
        box-shadow: 0 8px 32px rgba(30, 60, 114, 0.25);
        transition: var(--transition);
        z-index: 9999;
        display: flex;
        align-items: center;
        justify-content: center;
    }
    
    .chatbot-fab:hover {
        transform: scale(1.05) translateY(-2px);
        box-shadow: 0 12px 40px rgba(30, 60, 114, 0.35);
    }
    
    .chatbot-container {
        position: fixed;
        bottom: 100px;
        left: var(--spacing-lg);
        width: 380px;
        max-height: 600px;
        background: var(--surface-gradient);
        border-radius: var(--border-radius);
        box-shadow: 0 20px 60px rgba(0,0,0,0.15);
        z-index: 9998;
        transform: translateY(100%);
        opacity: 0;
        transition: var(--transition);
        overflow: hidden;
        border: 1px solid var(--border-color);
    }
    
    .chatbot-container.open {
        transform: translateY(0);
        opacity: 1;
    }
    
    .chatbot-header {
        background: var(--primary-gradient);
        color: white;
        padding: var(--spacing-lg);
        cursor: pointer;
        display: grid;
        grid-template-columns: 1fr auto;
        gap: var(--spacing-md);
        align-items: center;
    }
    
    .chatbot-title h4 {
        margin: 0 0 4px 0;
        font-size: 1.2rem;
        font-weight: 600;
    }
    
    .chatbot-status {
        font-size: 0.85rem;
        opacity: 0.9;
        display: flex;
        align-items: center;
        gap: 6px;
    }
    
    .status-dot {
        width: 8px;
        height: 8px;
        background: #4caf50;
        border-radius: 50%;
        animation: pulse 2s infinite;
    }
    
    .chatbot-toggle {
        font-size: 1.3rem;
        transition: transform 0.3s ease;
    }
    
    .chatbot-container.open .chatbot-toggle {
        transform: rotate(180deg);
    }
    
    .chatbot-messages {
        height: 380px;
        overflow-y: auto;
        padding: var(--spacing-lg);
        display: flex;
        flex-direction: column;
        gap: var(--spacing-md);
    }
    
    .message {
        display: grid;
        grid-template-columns: auto 1fr;
        gap: var(--spacing-sm);
        align-items: flex-start;
        animation: messageSlide 0.3s ease;
    }
    
    .user-message {
        grid-template-columns: 1fr auto;
    }
    
    @keyframes messageSlide {
        from {
            opacity: 0;
            transform: translateY(10px);
        }
        to {
            opacity: 1;
            transform: translateY(0);
        }
    }
    
    .message-avatar {
        width: 36px;
        height: 36px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 1.2rem;
        flex-shrink: 0;
    }
    
    .bot-message .message-avatar {
        background: var(--primary-gradient);
        color: white;
    }
    
    .user-message .message-avatar {
        background: var(--secondary-gradient);
        color: white;
        order: 2;
    }
    
    .message-content {
        background: var(--surface-gradient);
        padding: var(--spacing-md) var(--spacing-lg);
        border-radius: var(--border-radius);
        max-width: 280px;
        font-size: 0.95rem;
        line-height: 1.4;
        border: 1px solid var(--border-color);
    }
    
    .user-message .message-content {
        background: var(--secondary-gradient);
        color: white;
        border-color: transparent;
        justify-self: end;
    }
    
    .message-content p {
        margin: 0 0 var(--spacing-xs) 0;
    }
    
    .message-content p:last-child {
        margin-bottom: 0;
    }
    
    .suggestion-buttons {
        display: flex;
        flex-wrap: wrap;
        gap: var(--spacing-xs);
        margin-top: var(--spacing-sm);
    }
    
    .suggestion-btn {
        background: var(--primary-gradient);
        color: white;
        border: none;
        padding: 6px var(--spacing-sm);
        border-radius: var(--spacing-md);
        font-size: 0.8rem;
        cursor: pointer;
        transition: var(--transition);
    }
    
    .suggestion-btn:hover {
        transform: translateY(-1px);
        box-shadow: 0 4px 12px rgba(30, 60, 114, 0.25);
    }
    
    .chatbot-input {
        padding: var(--spacing-lg);
        border-top: 1px solid var(--border-color);
        display: grid;
        grid-template-columns: 1fr auto;
        gap: var(--spacing-sm);
        align-items: center;
        background: var(--surface-gradient);
    }
    
    .chatbot-input input {
        padding: var(--spacing-sm) var(--spacing-md);
        border: 1px solid var(--border-color);
        border-radius: 24px;
        font-size: 0.95rem;
        outline: none;
        transition: var(--transition);
    }
    
    .chatbot-input input:focus {
        border-color: #667eea;
        box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
    }
    
    .chatbot-send-btn {
        width: 44px;
        height: 44px;
        background: var(--primary-gradient);
        border: none;
        border-radius: 50%;
        color: white;
        cursor: pointer;
        transition: var(--transition);
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 1.1rem;
    }
    
    .chatbot-send-btn:hover {
        transform: scale(1.05);
        box-shadow: 0 4px 16px rgba(30, 60, 114, 0.25);
    }
    
    /* Perfect Responsive Design */
    @media (max-width: 1400px) {
        .container {
            grid-template-columns: 1fr;
            gap: var(--spacing-md);
        }
        
        .sidebar {
            order: 2;
            position: static;
        }
        
        .map-container {
            height: 500px;
            order: 1;
        }
        
        .chatbot-container {
            width: 320px;
        }
    }
    
    @media (max-width: 768px) {
        .header h1 {
            font-size: 2rem;
        }
        
        .header p {
            font-size: 1rem;
        }
        
        .container {
            padding: var(--spacing-md);
            gap: var(--spacing-md);
        }
        
       .tab-content {
    padding: var(--spacing-md);
    max-height: calc(100vh - 240px);
    overflow-y: auto;
    display: flex;
    flex-direction: column;
    gap: var(--spacing-sm);
}
        .chatbot-container {
            left: var(--spacing-md);
            right: var(--spacing-md);
            width: auto;
        }
        
        .chatbot-fab {
            left: var(--spacing-md);
            bottom: var(--spacing-md);
        }
        
        .debug-status {
            right: var(--spacing-md);
            bottom: var(--spacing-md);
        }
        
        .village-header {
            grid-template-columns: 1fr;
            text-align: center;
        }
        
        .scheme-header {
            grid-template-columns: 1fr;
            gap: var(--spacing-sm);
        }
        
        .eligibility-score {
            grid-template-columns: 1fr;
            gap: var(--spacing-xs);
            text-align: center;
        }
    }
    
    /* Perfect Custom Scrollbar */
    ::-webkit-scrollbar {
        width: 8px;
    }
    
    ::-webkit-scrollbar-track {
        background: var(--border-color);
        border-radius: 4px;
    }
    
    ::-webkit-scrollbar-thumb {
        background: var(--primary-gradient);
        border-radius: 4px;
    }
    
    ::-webkit-scrollbar-thumb:hover {
        background: var(--secondary-gradient);
    }
    
    /* Perfect Animation Keyframes */
    @keyframes fadeIn {
        from { opacity: 0; }
        to { opacity: 1; }
    }
    
    @keyframes slideUp {
        from {
            opacity: 0;
            transform: translateY(30px);
        }
        to {
            opacity: 1;
            transform: translateY(0);
        }
    }
    
    /* Perfect Focus States */
    button:focus-visible,
    input:focus-visible {
        outline: 2px solid #667eea;
        outline-offset: 2px;
    }
    
    /* Panel Styles */
    .panel {
        position: fixed;
        top: 20px;
        right: 20px;
        width: 400px;
        max-height: 80vh;
        background: white;
        border-radius: 12px;
        box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        z-index: 1000;
        overflow: hidden;
    }
    
    .panel-header {
        background: linear-gradient(135deg, #1b5e20, #2e7d32);
        color: white;
        padding: 15px 20px;
        display: flex;
        justify-content: space-between;
        align-items: center;
    }
    
    .panel-header h3 {
        margin: 0;
        font-size: 16px;
        font-weight: 600;
    }
    
    .close-btn {
        background: none;
        border: none;
        color: white;
        font-size: 20px;
        cursor: pointer;
        padding: 0;
        width: 24px;
        height: 24px;
        display: flex;
        align-items: center;
        justify-content: center;
    }
    
    .panel-content {
        padding: 20px;
        max-height: calc(80vh - 60px);
        overflow-y: auto;
    }
    
    /* Breadcrumb Styles */
    .breadcrumb {
        display: flex;
        gap: 8px;
        margin-bottom: 20px;
        padding-bottom: 10px;
        border-bottom: 1px solid #eee;
    }
    
    .breadcrumb-item {
        padding: 6px 12px;
        background: #f5f5f5;
        border-radius: 6px;
        cursor: pointer;
        font-size: 12px;
        transition: all 0.2s ease;
    }
    
    .breadcrumb-item:hover {
        background: #e0e0e0;
    }
    
    .breadcrumb-item.active {
        background: #2e7d32;
        color: white;
    }
    
    /* Navigation Content */
    .navigation-content {
        max-height: 400px;
        overflow-y: auto;
    }
    
    .nav-item {
        padding: 12px 16px;
        border: 1px solid #e0e0e0;
        border-radius: 8px;
        margin-bottom: 8px;
        cursor: pointer;
        transition: all 0.2s ease;
        background: white;
    }
    
    .nav-item:hover {
        background: #f8f9fa;
        border-color: #2e7d32;
    }
    
    .nav-item-header {
        font-weight: 600;
        color: #1b5e20;
        margin-bottom: 4px;
    }
    
    .nav-item-stats {
        font-size: 12px;
        color: #666;
    }
    
    /* Search Form */
    .search-form {
        margin-bottom: 20px;
    }
    
    .search-form input {
        width: 100%;
        padding: 12px 16px;
        border: 1px solid #ddd;
        border-radius: 8px;
        font-size: 14px;
        margin-bottom: 12px;
    }
    
    .search-filters {
        display: flex;
        gap: 8px;
    }
    
    .search-filters select {
        flex: 1;
        padding: 8px 12px;
        border: 1px solid #ddd;
        border-radius: 6px;
        font-size: 12px;
    }
    
    /* Search Results */
    .search-results {
        max-height: 300px;
        overflow-y: auto;
    }
    
    .search-result-item {
        padding: 12px;
        border: 1px solid #e0e0e0;
        border-radius: 8px;
        margin-bottom: 8px;
        cursor: pointer;
        transition: all 0.2s ease;
    }
    
    .search-result-item:hover {
        background: #f8f9fa;
        border-color: #2e7d32;
    }
    
    .search-result-header {
        font-weight: 600;
        color: #1b5e20;
        margin-bottom: 4px;
    }
    
    .search-result-details {
        font-size: 12px;
        color: #666;
    }
    
    /* Filter Sections */
    .filter-section {
        margin-bottom: 20px;
        padding-bottom: 15px;
        border-bottom: 1px solid #eee;
    }
    
    .filter-section:last-child {
        border-bottom: none;
        margin-bottom: 0;
    }
    
    .filter-section h4 {
        margin: 0 0 10px 0;
        font-size: 14px;
        color: #1b5e20;
    }
    
    .filter-section label {
        display: block;
        margin-bottom: 8px;
        font-size: 13px;
        cursor: pointer;
    }
    
    .filter-section input[type="checkbox"] {
        margin-right: 8px;
    }
    
    .filter-section input[type="range"] {
        width: 100%;
        margin-bottom: 8px;
    }
    
    #area-value {
        font-size: 12px;
        color: #666;
    }
</style>

</head>
<body data-current-lang="{{ current_lang or 'english' }}">
<div class="auth-header" style="background: var(--primary-gradient); color: white; padding: 15px 20px; display: flex; justify-content: space-between; align-items: center;">
    <div style="display: flex; align-items: center; gap: 15px;">
        <div style="font-size: 1.5rem;">
            {% if session.user_role == 'CCF' %}üèõÔ∏è
            {% elif session.user_role == 'DCF' %}üëî
            {% elif session.user_role == 'RFO' %}üå≤
            {% elif session.user_role == 'GRAM_SABHA' %}üèòÔ∏è
            {% else %}üë§
            {% endif %}
        </div>
        <div>
            <div style="font-weight: 600;">{{ session.user_name }}</div>
            <div style="font-size: 0.9em; opacity: 0.9;">{{ session.user_role }} Access</div>
        </div>
    </div>
</div>

    <!-- Debug Status -->
    <div class="debug-status" id="debug-status">
        System: Initializing...
    </div>

    <!-- Top Navigation Bar -->
    <nav class="top-navbar">
        <div class="navbar-brand">
            <h1 id="dashboard-title">üõ°Ô∏è FRA Sentinel</h1>
        </div>
        
        <div class="navbar-center">
            <div class="nav-features">
                <a href="{{ url_for('ai_predictions') }}" class="btn-unified btn-primary nav-btn ai-predictions">
                    <span class="nav-icon">üîÆ</span>
                    <span class="nav-text" id="nav-ai-predictions">{% trans %}AI Predictions{% endtrans %}</span>
                </a>
                <a href="{{ url_for('analytics') }}" class="btn-unified btn-primary nav-btn analytics">
                    <span class="nav-icon">üìä</span>
                    <span class="nav-text" id="nav-analytics">{% trans %}Analytics{% endtrans %}</span>
                </a>
                <a href="{{ url_for('reports') }}" class="btn-unified btn-primary nav-btn reports">
                    <span class="nav-icon">üìà</span>
                    <span class="nav-text" id="nav-reports">{% trans %}Reports{% endtrans %}</span>
                </a>
                <a href="{{ url_for('schemes') }}" class="btn-unified btn-primary nav-btn schemes">
                    <span class="nav-icon">üèõÔ∏è</span>
                    <span class="nav-text" id="nav-schemes">{% trans %}Schemes{% endtrans %}</span>
                </a>
                <a href="{{ url_for('fra_data_collection') }}" class="btn-unified btn-primary nav-btn data-collection">
                    <span class="nav-icon">üìã</span>
                    <span class="nav-text" id="nav-enter-data">{% trans %}Enter Data{% endtrans %}</span>
                </a>
            </div>
        </div>
        
        <div class="navbar-right">
            <!-- Language Switcher -->
            <div class="language-switcher">
                <select id="language-select" onchange="changeLanguageDirect(this.value)">
                    <option value="en" {% if current_lang == 'en' %}selected{% endif %}>üá∫üá∏ English</option>
                    <option value="hi" {% if current_lang == 'hi' %}selected{% endif %}>üáÆüá≥ ‡§π‡§ø‡§Ç‡§¶‡•Ä</option>
                    <option value="ta" {% if current_lang == 'ta' %}selected{% endif %}>üáÆüá≥ ‡Æ§‡ÆÆ‡Æø‡Æ¥‡Øç</option>
                    <option value="te" {% if current_lang == 'te' %}selected{% endif %}>üáÆüá≥ ‡∞§‡±Ü‡∞≤‡±Å‡∞ó‡±Å</option>
                </select>
            </div>
            
            <!-- User Profile -->
            <div class="user-profile">
                <div class="profile-avatar">
                    <span class="avatar-icon">üë§</span>
                </div>
                <div class="profile-info">
                    <span class="profile-name">{{ session.user_name }}</span>
                    <span class="profile-role">{{ session.user_role }}</span>
                </div>
            </div>
            
            <!-- Admin Dropdown -->
            {% if session.user_role in ['CCF', 'DCF', 'RFO'] %}
            <div class="admin-dropdown">
                <button class="admin-btn" onclick="toggleAdminDropdown()">
                    <span class="admin-icon">üõ†Ô∏è</span>
                    <span class="admin-text">Admin</span>
                    <span class="dropdown-arrow">‚ñº</span>
                </button>
                <div class="admin-menu" id="admin-menu">
                    <a href="{{ url_for('admin_dashboard') }}" class="admin-item">
                        <span class="item-icon">üìä</span>
                        <span class="item-text">Dashboard</span>
                    </a>
                    <a href="{{ url_for('patta_digitization') }}" class="admin-item">
                        <span class="item-icon">üîç</span>
                        <span class="item-text">Patta Digitization</span>
                    </a>
                    <a href="{{ url_for('upload_new') }}" class="admin-item">
                        <span class="item-icon">üìÑ</span>
                        <span class="item-text">Upload Document</span>
                    </a>
                    <a href="{{ url_for('blockchain_storage') }}" class="admin-item">
                        <span class="item-icon">üîó</span>
                        <span class="item-text">Blockchain Storage</span>
                    </a>
                    <div class="admin-divider"></div>
                    <a href="{{ url_for('logout') }}" class="admin-item logout-item">
                        <span class="item-icon">üö™</span>
                        <span class="item-text">Logout</span>
                    </a>
                </div>
            </div>
            {% else %}
            <a href="{{ url_for('logout') }}" class="logout-btn">
                <span class="logout-icon">üö™</span>
                <span class="logout-text">Logout</span>
            </a>
            {% endif %}
        </div>
    </nav>

    <!-- Main Container -->
    <div class="container">
        <!-- Resources Button -->
        <button class="resources-btn" onclick="toggleResourcesDrawer()">
            üìö Resources
        </button>

        <!-- Resources Drawer -->
        <div class="resources-drawer" id="resourcesDrawer">
            <div class="drawer-header">
                <h3>üìö FRA Resources & Guidelines</h3>
                <button class="close-drawer" onclick="toggleResourcesDrawer()">√ó</button>
            </div>
            <div class="drawer-content">
                <div class="resource-section">
                    <h4>üèõÔ∏è Official Portals</h4>
                    <div class="resource-links">
                        <a href="https://tribal.nic.in" target="_blank" class="resource-link">
                            <span class="link-icon">üåê</span>
                            <div class="link-content">
                                <strong>MoTA FRA Portal</strong>
                                <small>Ministry of Tribal Affairs</small>
                            </div>
                        </a>
                    </div>
                </div>
                
                <div class="resource-section">
                    <h4>üìã Guidelines & Documents</h4>
                    <div class="resource-links">
                        <a href="#" class="resource-link" onclick="downloadGuidelines('fra')">
                            <span class="link-icon">üìÑ</span>
                            <div class="link-content">
                                <strong>FRA Guidelines</strong>
                                <small>Forest Rights Act 2006</small>
                            </div>
                        </a>
                        <a href="#" class="resource-link" onclick="downloadGuidelines('dajgua')">
                            <span class="link-icon">üìÑ</span>
                            <div class="link-content">
                                <strong>DAJGUA Guidelines</strong>
                                <small>Convergence Framework</small>
                            </div>
                        </a>
                    </div>
                </div>
                
                <div class="resource-section">
                    <h4>üìû State Contacts</h4>
                    <div class="contact-list">
                        <div class="contact-item">
                            <strong>Madhya Pradesh</strong>
                            <div class="contact-details">
                                <span>üìß tribal.mp@nic.in</span>
                                <span>üì± +91-755-255-1234</span>
                            </div>
                        </div>
                        <div class="contact-item">
                            <strong>Odisha</strong>
                            <div class="contact-details">
                                <span>üìß tribal.odisha@nic.in</span>
                                <span>üì± +91-674-239-5678</span>
                            </div>
                        </div>
                        <div class="contact-item">
                            <strong>Tripura</strong>
                            <div class="contact-details">
                                <span>üìß tribal.tripura@nic.in</span>
                                <span>üì± +91-381-222-9012</span>
                            </div>
                        </div>
                        <div class="contact-item">
                            <strong>Telangana</strong>
                            <div class="contact-details">
                                <span>üìß tribal.telangana@nic.in</span>
                                <span>üì± +91-40-2345-3456</span>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="resource-section">
                    <h4>üè¢ Central Desk</h4>
                    <div class="contact-list">
                        <div class="contact-item">
                            <strong>FRA Helpline</strong>
                            <div class="contact-details">
                                <span>üì± 1800-180-5522</span>
                                <span>üìß fra.help@tribal.nic.in</span>
                            </div>
                        </div>
                        <div class="contact-item">
                            <strong>Technical Support</strong>
                            <div class="contact-details">
                                <span>üì± +91-11-2306-1234</span>
                                <span>üìß fra.tech@tribal.nic.in</span>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="compliance-note">
                    <p><strong>üìã Compliance Note:</strong></p>
                    <p>This system is aligned with MoTA FRA guidelines and DAJGUA convergence model for optimal scheme delivery to forest-dwelling communities.</p>
                </div>
            </div>
        </div>

        <!-- Compliance Note -->
        <div class="compliance-note-atlas">
            <small>üìã Aligned with MoTA FRA guidelines and DAJGUA convergence model</small>
        </div>
        
        <!-- MPR Snapshot Card -->
        <div class="mpr-snapshot-card">
            <h4>üìä <span id="mpr-snapshot-title">{% trans %}MPR Snapshot{% endtrans %}</span></h4>
            <div id="mprSnapshotData">
                <p id="loading-mpr-text">{% trans %}Loading MPR data...{% endtrans %}</p>
            </div>
            <button onclick="loadMPRSnapshot()" class="refresh-btn" id="refresh-btn-text">{% trans %}Refresh{% endtrans %}</button>
        </div>

        <!-- Enhanced Sidebar -->
        <aside class="sidebar">
            <nav class="tab-navigation">
                <button class="tab-button active" data-tab="overview">
                    <span>üìä</span> <span id="tab-overview-text">{% trans %}Overview{% endtrans %}</span>
                </button>
                <button class="tab-button" data-tab="progress">
                    <span>üìà</span> <span id="tab-progress-text">{% trans %}Progress{% endtrans %}</span>
                </button>
                <button class="tab-button" data-tab="analytics">
                    <span>üìä</span> <span id="tab-analytics-text">{% trans %}Analytics{% endtrans %}</span>
                </button>
                <button class="tab-button" data-tab="export">
                    <span>üì•</span> <span id="tab-export-text">{% trans %}Export{% endtrans %}</span>
                </button>
            </nav>

            <div class="tab-content">
                <div id="overview" class="tab-pane active">
                    <div class="info-section">
                        <h3><span class="section-icon">üèòÔ∏è</span> <span id="village-info-title">{% trans %}Village Information{% endtrans %}</span></h3>
                        <div id="village-info" class="loading">{% trans %}Loading village data...{% endtrans %}</div>
                    </div>

                    <div class="info-section">
                        <h3><span class="section-icon">üìä</span> <span id="land-stats-title">{% trans %}Land Use Statistics{% endtrans %}</span></h3>
                        <div id="land-stats" class="loading">{% trans %}Calculating statistics...{% endtrans %}</div>
                    </div>

                    <div class="info-section">
                        <h3><span class="section-icon">üéØ</span> <span id="recommendations-title">{% trans %}Smart Recommendations{% endtrans %}</span></h3>
                        <div id="recommendations" class="loading">{% trans %}Analyzing data...{% endtrans %}</div>
                    </div>
                </div>

                <div id="progress" class="tab-pane">
                    <div class="info-section">
                        <h3><span class="section-icon">üìà</span> <span id="progress-tracking-title">{% trans %}Progress Tracking{% endtrans %}</span></h3>
                        <div class="breadcrumb-nav" id="breadcrumbNav">
                            <span class="breadcrumb-item active" data-scope="state" data-id=""><span id="all-states-text">{% trans %}All States{% endtrans %}</span></span>
                        </div>
                        
                        <div class="progress-stats" id="progressStats">
                            <div class="stat-item">
                                <span class="stat-label"><span id="ifr-claims-text">{% trans %}IFR Claims{% endtrans %}</span></span>
                                <span class="stat-value" id="ifrStats">{% trans %}Loading...{% endtrans %}</span>
                            </div>
                            <div class="stat-item">
                                <span class="stat-label"><span id="cr-claims-text">{% trans %}CR Claims{% endtrans %}</span></span>
                                <span class="stat-value" id="crStats">{% trans %}Loading...{% endtrans %}</span>
                            </div>
                            <div class="stat-item">
                                <span class="stat-label"><span id="cfr-claims-text">{% trans %}CFR Claims{% endtrans %}</span></span>
                                <span class="stat-value" id="cfrStats">{% trans %}Loading...{% endtrans %}</span>
                            </div>
                        </div>
                        
                        <div class="stacked-bars" id="stackedBars">
                            <canvas id="progressChart" width="400" height="200"></canvas>
                        </div>
                        
                        <div class="top-pending" id="topPending">
                            <h4><span id="top-pending-title">{% trans %}Top Pending Villages{% endtrans %}</span></h4>
                            <div class="pending-list" id="pendingList">
                                {% trans %}Loading...{% endtrans %}
                            </div>
                        </div>
                    </div>
                </div>

                <div id="analytics" class="tab-pane">
                    <div class="info-section">
                        <h3><span class="section-icon">üìà</span> <span id="system-analytics-title">{% trans %}System Analytics{% endtrans %}</span></h3>
                        <div id="system-analytics">
                            <div style="margin-bottom: 20px; text-align: center;">
                                <a href="{{ url_for('detailed_analytics') }}" class="btn-unified btn-primary" style="padding: 12px 25px; font-size: 1.1rem; text-decoration: none; display: inline-block;">
                                    <span>üìä</span> {% trans %}View Detailed Analytics{% endtrans %}
                                </a>
                            </div>
                            <div class="stat-item">
                                <span class="stat-label">
                                    <span>üü¢</span> <span id="system-status-label">{% trans %}System Status{% endtrans %}</span>
                                </span>
                                <span class="stat-value" id="system-status">{% trans %}Checking...{% endtrans %}</span>
                            </div>
                            <div class="stat-item">
                                <span class="stat-label">
                                    <span>üèòÔ∏è</span> <span id="villages-loaded-label">{% trans %}Villages Loaded{% endtrans %}</span>
                                </span>
                                <span class="stat-value" id="villages-count">-</span>
                            </div>
                            <div class="stat-item">
                                <span class="stat-label">
                                    <span>üìä</span> <span id="data-categories-label">{% trans %}Data Categories{% endtrans %}</span>
                                </span>
                                <span class="stat-value" id="stats-count">-</span>
                            </div>
                        </div>
                    </div>
                </div>

                <div id="export" class="tab-pane">
                    <div class="info-section">
                        <h3><span class="section-icon">üì•</span> <span id="export-options-title">{% trans %}Export Options{% endtrans %}</span></h3>
                        <div class="stat-item">
                            <span class="stat-label">
                                <span>üìÑ</span> <span id="pdf-report-label">{% trans %}PDF Report{% endtrans %}</span>
                            </span>
                            <button class="control-button" id="generate-pdf-btn">{% trans %}Generate{% endtrans %}</button>
                        </div>
                        <div class="stat-item">
                            <span class="stat-label">
                                <span>üìä</span> <span id="excel-data-label">{% trans %}Excel Data{% endtrans %}</span>
                            </span>
                            <button class="control-button" id="export-excel-btn">{% trans %}Export{% endtrans %}</button>
                        </div>
                    </div>
                </div>
            </div>
        </aside>

        <!-- Enhanced Map Container with Layer Controls -->
        <main class="map-container">
            <div class="map-controls">
                <div class="control-group">
                    <button class="control-button active" id="street-view" onclick="switchMapLayer('street')">
                        <span class="control-icon">üó∫Ô∏è</span> Street
                    </button>
                    <button class="control-button" id="satellite-view" onclick="switchMapLayer('satellite')">
                        <span class="control-icon">üõ∞Ô∏è</span> Satellite
                    </button>
                    <button class="control-button" id="terrain-view" onclick="switchMapLayer('terrain')">
                        <span class="control-icon">üèîÔ∏è</span> Terrain
                    </button>
                </div>
                
                <div class="control-group">
                    <button class="control-button" onclick="resetMapView()">
                        <span class="control-icon">üè†</span> Reset
                    </button>
                    <button class="control-button" onclick="toggleFullscreen()">
                        <span class="control-icon">‚õ∂</span> Full
                    </button>
                    <button class="control-button" onclick="exportAtlasData('csv')">
                        <span class="control-icon">üìä</span> CSV
                    </button>
                    <button class="control-button" onclick="exportAtlasData('geojson')">
                        <span class="control-icon">üó∫Ô∏è</span> GeoJSON
                    </button>
                </div>
                
                
                
                <div class="control-group">
                    <button class="control-button" onclick="showDrillDownPanel()">
                        <span class="control-icon">üîç</span> Drill Down
                    </button>
                    <button class="control-button" onclick="showSearchPanel()">
                        <span class="control-icon">üîé</span> Search
                    </button>
                    <button class="control-button" onclick="showFiltersPanel()">
                        <span class="control-icon">üéõÔ∏è</span> Filters
                    </button>
                </div>
            </div>
            
            <div id="map"></div>
        </main>
        
        <!-- FRA Atlas Drill-down Panel -->
        <div id="drill-down-panel" class="panel" style="display: none;">
            <div class="panel-header">
                <h3>üó∫Ô∏è FRA Atlas Navigation</h3>
                <button class="close-btn" onclick="hideDrillDownPanel()">√ó</button>
            </div>
            <div class="panel-content">
                <div id="navigation-breadcrumb" class="breadcrumb">
                    <span class="breadcrumb-item active" onclick="loadStates()">States</span>
                </div>
                <div id="navigation-content" class="navigation-content">
                    <!-- Dynamic content will be loaded here -->
                </div>
            </div>
        </div>
        
        <!-- Search Panel -->
        <div id="search-panel" class="panel" style="display: none;">
            <div class="panel-header">
                <h3>üîé Search FRA Data</h3>
                <button class="close-btn" onclick="hideSearchPanel()">√ó</button>
            </div>
            <div class="panel-content">
                <div class="search-form">
                    <input type="text" id="search-input" placeholder="Search by patta holder, village, or tribal group..." 
                           onkeyup="performSearch()">
                    <div class="search-filters">
                        <select id="status-filter" onchange="performSearch()">
                            <option value="all">All Status</option>
                            <option value="pending">Pending</option>
                            <option value="verified">Verified</option>
                            <option value="approved">Approved</option>
                        </select>
                        <select id="type-filter" onchange="performSearch()">
                            <option value="all">All Types</option>
                            <option value="IFR">IFR</option>
                            <option value="CR">CR</option>
                            <option value="CFR">CFR</option>
                        </select>
                    </div>
                </div>
                <div id="search-results" class="search-results">
                    <!-- Search results will be displayed here -->
                </div>
            </div>
        </div>
        
        <!-- Filters Panel -->
        <div id="filters-panel" class="panel" style="display: none;">
            <div class="panel-header">
                <h3>üéõÔ∏è Map Filters</h3>
                <button class="close-btn" onclick="hideFiltersPanel()">√ó</button>
            </div>
            <div class="panel-content">
                <div class="filter-section">
                    <h4>FRA Claims Status</h4>
                    <label><input type="checkbox" checked onchange="updateClaimStatusFilter()"> Pending</label>
                    <label><input type="checkbox" checked onchange="updateClaimStatusFilter()"> Verified</label>
                    <label><input type="checkbox" checked onchange="updateClaimStatusFilter()"> Approved</label>
                </div>
                <div class="filter-section">
                    <h4>Claim Types</h4>
                    <label><input type="checkbox" checked onchange="updateClaimTypeFilter()"> IFR (Individual Forest Rights)</label>
                    <label><input type="checkbox" checked onchange="updateClaimTypeFilter()"> CR (Community Rights)</label>
                    <label><input type="checkbox" checked onchange="updateClaimTypeFilter()"> CFR (Community Forest Resource)</label>
                </div>
                <div class="filter-section">
                    <h4>Tribal Groups</h4>
                    <label><input type="checkbox" checked onchange="updateTribalGroupFilter()"> Bhil</label>
                    <label><input type="checkbox" checked onchange="updateTribalGroupFilter()"> Gond</label>
                    <label><input type="checkbox" checked onchange="updateTribalGroupFilter()"> Baiga</label>
                </div>
                <div class="filter-section">
                    <h4>Area Range (Hectares)</h4>
                    <input type="range" id="area-range" min="0" max="10" value="10" onchange="updateAreaFilter()">
                    <span id="area-value">0-10 hectares</span>
                </div>
                <div class="filter-section">
                    <h4>Asset Overlays</h4>
                    <label><input type="checkbox" checked onchange="toggleAssetLayer('agriculture')"> Agriculture</label>
                    <label><input type="checkbox" checked onchange="toggleAssetLayer('forest')"> Forest Cover</label>
                    <label><input type="checkbox" checked onchange="toggleAssetLayer('water')"> Water Bodies</label>
                    <label><input type="checkbox" checked onchange="toggleAssetLayer('homestead')"> Homesteads</label>
                    <label><input type="checkbox" onchange="toggleAssetLayer('groundwater')"> Groundwater</label>
                    <label><input type="checkbox" onchange="toggleAssetLayer('pmgs')"> PM Gati Shakti</label>
                </div>
            </div>
        </div>
    </div>

    <!-- Chatbot Interface -->
    <div class="chatbot-container" id="chatbot-container">
        <div class="chatbot-header" onclick="toggleChatbot()">
            <div class="chatbot-title">
                <h4>ü§ñ FRA Assistant</h4>
                <div class="chatbot-status">
                    <span class="status-dot"></span>
                    <span>Online & Ready</span>
                </div>
            </div>
            <div class="chatbot-toggle" id="chatbot-toggle">‚ñº</div>
        </div>
        
        <div class="chatbot-messages" id="chatbot-messages">
            <div class="message bot-message">
                <div class="message-avatar">ü§ñ</div>
                <div class="message-content">
                    <p>Welcome to FRA Atlas! I'm your intelligent assistant for Forest Rights Act queries.</p>
                    <p>I can help you with:</p>
                    <ul style="margin: 8px 0; padding-left: 20px;">
                        <li>FRA information & eligibility</li>
                        <li>Government scheme recommendations</li>
                        <li>Village data analysis</li>
                        <li>Land use classification details</li>
                    </ul>
                    <div class="suggestion-buttons">
                        <button class="suggestion-btn" onclick="sendSuggestion('Tell me about FRA')">About FRA</button>
                        <button class="suggestion-btn" onclick="sendSuggestion('What schemes are available?')">Available Schemes</button>
                        <button class="suggestion-btn" onclick="sendSuggestion('Show village analysis')">Village Analysis</button>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="chatbot-input">
            <input type="text" id="chatbot-input" placeholder="Ask me about FRA, schemes, or village data..." />
            <button class="chatbot-send-btn" onclick="sendMessage()">
                <span>üì§</span>
            </button>
        </div>
    </div>

    <!-- Chatbot Toggle Button -->
    <button class="chatbot-fab" onclick="toggleChatbot()" title="FRA Assistant">
        ü§ñ
    </button>

    <!-- Scripts -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script>
        console.log('üöÄ FRA Atlas Ultimate Starting...');
        
        // Global language state
        let currentGlobalLanguage = 'en';
        
        // Simple, reliable translation system
        const translations = {
            'en': {
                'overview': 'Overview',
                'progress': 'Progress', 
                'analytics': 'Analytics',
                'export': 'Export',
                'village_information': 'Village Information',
                'land_use_statistics': 'Land Use Statistics',
                'smart_recommendations': 'Smart Recommendations',
                'mpr_snapshot': 'MPR Snapshot',
                'refresh': 'Refresh',
                'total_claims': 'Total Claims',
                'granted': 'Granted',
                'area_vested': 'Area Vested',
                'last_updated': 'Last Updated',
                'farmland': 'Farmland',
                'forest': 'Forest',
                'homestead': 'Homestead',
                'water': 'Water',
                'pixels': 'pixels',
                'patta_holder': 'Patta Holder',
                'land_area': 'Land Area',
                'claim_status': 'Claim Status',
                'location': 'Location',
                'hectares': 'ha',
                'forest_rights_village': 'Forest Rights Village',
                'approved': 'Approved',
                'pending': 'Pending',
                'verified': 'Verified',
                'ai_predictions': 'AI Predictions',
                'reports': 'Reports',
                'schemes': 'Schemes',
                'enter_data': 'Enter Data',
                'not_specified': 'Not specified',
                'unknown': 'Unknown',
                'unknown_status': 'Unknown Status',
                'unknown_village': 'Unknown Village',
                'n_a': 'N/A',
                'states': 'States',
                'loading_recommendations': 'Loading recommendations...',
                'loading_mpr_data': 'Loading MPR data...',
                'error_loading_mpr': 'Error loading MPR data',
                'error_loading_recommendations': 'Error loading recommendations',
                'view_detailed_analytics': 'View Detailed Analytics'
            },
            'hi': {
                'overview': '‡§Ö‡§µ‡§≤‡•ã‡§ï‡§®',
                'progress': '‡§™‡•ç‡§∞‡§ó‡§§‡§ø',
                'analytics': '‡§µ‡§ø‡§∂‡•ç‡§≤‡•á‡§∑‡§£', 
                'export': '‡§®‡§ø‡§∞‡•ç‡§Ø‡§æ‡§§',
                'village_information': '‡§ó‡§æ‡§Ç‡§µ ‡§ï‡•Ä ‡§ú‡§æ‡§®‡§ï‡§æ‡§∞‡•Ä',
                'land_use_statistics': '‡§≠‡•Ç‡§Æ‡§ø ‡§â‡§™‡§Ø‡•ã‡§ó ‡§Ü‡§Ç‡§ï‡§°‡§º‡•á',
                'smart_recommendations': '‡§∏‡•ç‡§Æ‡§æ‡§∞‡•ç‡§ü ‡§∏‡•Å‡§ù‡§æ‡§µ',
                'mpr_snapshot': 'MPR ‡§∏‡•ç‡§®‡•à‡§™‡§∂‡•â‡§ü',
                'refresh': '‡§∞‡§ø‡§´‡•ç‡§∞‡•á‡§∂',
                'total_claims': '‡§ï‡•Å‡§≤ ‡§¶‡§æ‡§µ‡•á',
                'granted': '‡§Ö‡§®‡•Å‡§Æ‡•ã‡§¶‡§ø‡§§',
                'area_vested': '‡§µ‡•á‡§∏‡•ç‡§ü‡•á‡§° ‡§ï‡•ç‡§∑‡•á‡§§‡•ç‡§∞',
                'last_updated': '‡§Ö‡§Ç‡§§‡§ø‡§Æ ‡§Ö‡§™‡§°‡•á‡§ü',
                'farmland': '‡§ï‡•É‡§∑‡§ø ‡§≠‡•Ç‡§Æ‡§ø',
                'forest': '‡§µ‡§®',
                'homestead': '‡§Ü‡§µ‡§æ‡§∏',
                'water': '‡§ú‡§≤',
                'pixels': '‡§™‡§ø‡§ï‡•ç‡§∏‡•á‡§≤',
                'patta_holder': '‡§™‡§ü‡•ç‡§ü‡§æ ‡§ß‡§æ‡§∞‡§ï',
                'land_area': '‡§≠‡•Ç‡§Æ‡§ø ‡§ï‡•ç‡§∑‡•á‡§§‡•ç‡§∞',
                'claim_status': '‡§¶‡§æ‡§µ‡§æ ‡§∏‡•ç‡§•‡§ø‡§§‡§ø',
                'location': '‡§∏‡•ç‡§•‡§æ‡§®',
                'hectares': '‡§π‡•á‡§ï‡•ç‡§ü‡•á‡§Ø‡§∞',
                'forest_rights_village': '‡§µ‡§® ‡§Ö‡§ß‡§ø‡§ï‡§æ‡§∞ ‡§ó‡§æ‡§Ç‡§µ',
                'approved': '‡§Ö‡§®‡•Å‡§Æ‡•ã‡§¶‡§ø‡§§',
                'pending': '‡§≤‡§Ç‡§¨‡§ø‡§§',
                'verified': '‡§∏‡§§‡•ç‡§Ø‡§æ‡§™‡§ø‡§§',
                'ai_predictions': '‡§è‡§Ü‡§à ‡§≠‡§µ‡§ø‡§∑‡•ç‡§Ø‡§µ‡§æ‡§£‡•Ä',
                'reports': '‡§∞‡§ø‡§™‡•ã‡§∞‡•ç‡§ü‡•ç‡§∏',
                'schemes': '‡§Ø‡•ã‡§ú‡§®‡§æ‡§è‡§Ç',
                'enter_data': '‡§°‡•á‡§ü‡§æ ‡§¶‡§∞‡•ç‡§ú ‡§ï‡§∞‡•á‡§Ç',
                'not_specified': '‡§®‡§ø‡§∞‡•ç‡§¶‡§ø‡§∑‡•ç‡§ü ‡§®‡§π‡•Ä‡§Ç',
                'unknown': '‡§Ö‡§ú‡•ç‡§û‡§æ‡§§',
                'unknown_status': '‡§Ö‡§ú‡•ç‡§û‡§æ‡§§ ‡§∏‡•ç‡§•‡§ø‡§§‡§ø',
                'unknown_village': '‡§Ö‡§ú‡•ç‡§û‡§æ‡§§ ‡§ó‡§æ‡§Ç‡§µ',
                'n_a': '‡§â‡§™‡§≤‡§¨‡•ç‡§ß ‡§®‡§π‡•Ä‡§Ç',
                'states': '‡§∞‡§æ‡§ú‡•ç‡§Ø',
                'loading_recommendations': '‡§∏‡•Å‡§ù‡§æ‡§µ ‡§≤‡•ã‡§° ‡§π‡•ã ‡§∞‡§π‡•á ‡§π‡•à‡§Ç...',
                'loading_mpr_data': 'MPR ‡§°‡•á‡§ü‡§æ ‡§≤‡•ã‡§° ‡§π‡•ã ‡§∞‡§π‡§æ ‡§π‡•à...',
                'error_loading_mpr': 'MPR ‡§°‡•á‡§ü‡§æ ‡§≤‡•ã‡§° ‡§ï‡§∞‡§®‡•á ‡§Æ‡•á‡§Ç ‡§§‡•ç‡§∞‡•Å‡§ü‡§ø',
                'error_loading_recommendations': '‡§∏‡•Å‡§ù‡§æ‡§µ ‡§≤‡•ã‡§° ‡§ï‡§∞‡§®‡•á ‡§Æ‡•á‡§Ç ‡§§‡•ç‡§∞‡•Å‡§ü‡§ø',
                'view_detailed_analytics': '‡§µ‡§ø‡§∏‡•ç‡§§‡•É‡§§ ‡§µ‡§ø‡§∂‡•ç‡§≤‡•á‡§∑‡§£ ‡§¶‡•á‡§ñ‡•á‡§Ç'
            },
            'ta': {
                'overview': '‡ÆÖ‡Æ©‡Øà‡Æ§‡Øç‡Æ§‡ØÅ ‡ÆÆ‡Ææ‡Æ®‡Æø‡Æ≤‡Æô‡Øç‡Æï‡Æ≥‡Øç',
                'progress': '‡Æ™‡Æï‡ØÅ‡Æ™‡Øç‡Æ™‡Ææ‡ÆØ‡Øç‡Æµ‡ØÅ',
                'analytics': '‡Æ™‡Æï‡ØÅ‡Æ™‡Øç‡Æ™‡Ææ‡ÆØ‡Øç‡Æµ‡ØÅ',
                'export': '‡Æè‡Æ±‡Øç‡Æ±‡ØÅ‡ÆÆ‡Æ§‡Æø',
                'village_information': '‡Æï‡Æø‡Æ∞‡Ææ‡ÆÆ ‡Æ§‡Æï‡Æµ‡Æ≤‡Øç',
                'land_use_statistics': '‡Æ®‡Æø‡Æ≤ ‡Æ™‡ÆØ‡Æ©‡Øç‡Æ™‡Ææ‡Æü‡Øç‡Æü‡ØÅ ‡Æ™‡ØÅ‡Æ≥‡Øç‡Æ≥‡Æø‡Æµ‡Æø‡Æµ‡Æ∞‡Æô‡Øç‡Æï‡Æ≥‡Øç',
                'smart_recommendations': '‡Æ∏‡Øç‡ÆÆ‡Ææ‡Æ∞‡Øç‡Æü‡Øç ‡Æ™‡Æ∞‡Æø‡Æ®‡Øç‡Æ§‡ØÅ‡Æ∞‡Øà‡Æï‡Æ≥‡Øç',
                'mpr_snapshot': 'MPR ‡Æ∏‡Øç‡Æ©‡Ææ‡Æ™‡Øç‡Æ∑‡Ææ‡Æü‡Øç',
                'refresh': '‡Æ™‡ØÅ‡Æ§‡ØÅ‡Æ™‡Øç‡Æ™‡Æø‡Æï‡Øç‡Æï‡Æµ‡ØÅ‡ÆÆ‡Øç',
                'total_claims': '‡ÆÆ‡Øä‡Æ§‡Øç‡Æ§ ‡Æï‡Øã‡Æ∞‡Æø‡Æï‡Øç‡Æï‡Øà‡Æï‡Æ≥‡Øç',
                'granted': '‡ÆÖ‡Æ©‡ØÅ‡ÆÆ‡Æ§‡Æø‡Æï‡Øç‡Æï‡Æ™‡Øç‡Æ™‡Æü‡Øç‡Æü‡Æ§‡ØÅ',
                'area_vested': '‡Æµ‡ØÜ‡Æ∏‡Øç‡Æü‡Æü‡Øç ‡Æ™‡Æï‡ØÅ‡Æ§‡Æø',
                'last_updated': '‡Æï‡Æü‡Øà‡Æö‡Æø ‡Æ™‡ØÅ‡Æ§‡ØÅ‡Æ™‡Øç‡Æ™‡Æø‡Æ™‡Øç‡Æ™‡ØÅ',
                'farmland': '‡Æµ‡Æø‡Æµ‡Æö‡Ææ‡ÆØ ‡Æ®‡Æø‡Æ≤‡ÆÆ‡Øç',
                'forest': '‡Æµ‡Æ©‡ÆÆ‡Øç',
                'homestead': '‡Æµ‡ØÄ‡Æü‡ØÅ',
                'water': '‡Æ®‡ØÄ‡Æ∞‡Øç',
                'pixels': '‡Æ™‡Æø‡Æï‡Øç‡Æö‡Æ≤‡Øç‡Æï‡Æ≥‡Øç',
                'patta_holder': '‡Æ™‡Æü‡Øç‡Æü‡Ææ ‡Æµ‡Øà‡Æ§‡Øç‡Æ§‡Æø‡Æ∞‡ØÅ‡Æ™‡Øç‡Æ™‡Æµ‡Æ∞‡Øç',
                'land_area': '‡Æ®‡Æø‡Æ≤‡Æ™‡Øç ‡Æ™‡Æ∞‡Æ™‡Øç‡Æ™‡ØÅ',
                'claim_status': '‡Æï‡Øã‡Æ∞‡Æø‡Æï‡Øç‡Æï‡Øà ‡Æ®‡Æø‡Æ≤‡Øà',
                'location': '‡Æá‡Æü‡ÆÆ‡Øç',
                'hectares': '‡Æπ‡ØÜ‡Æï‡Øç‡Æü‡Øá‡Æ∞‡Øç',
                'forest_rights_village': '‡Æµ‡Æ© ‡Æâ‡Æ∞‡Æø‡ÆÆ‡Øà ‡Æï‡Æø‡Æ∞‡Ææ‡ÆÆ‡ÆÆ‡Øç',
                'approved': '‡ÆÖ‡Æ©‡ØÅ‡ÆÆ‡Æ§‡Æø‡Æï‡Øç‡Æï‡Æ™‡Øç‡Æ™‡Æü‡Øç‡Æü‡Æ§‡ØÅ',
                'pending': '‡Æ®‡Æø‡Æ≤‡ØÅ‡Æµ‡Øà‡ÆØ‡Æø‡Æ≤‡Øç',
                'verified': '‡Æö‡Æ∞‡Æø‡Æ™‡Ææ‡Æ∞‡Øç‡Æï‡Øç‡Æï‡Æ™‡Øç‡Æ™‡Æü‡Øç‡Æü‡Æ§‡ØÅ',
                'ai_predictions': '‡Æè‡Æê ‡Æï‡Æ£‡Æø‡Æ™‡Øç‡Æ™‡ØÅ‡Æï‡Æ≥‡Øç',
                'reports': '‡ÆÖ‡Æ±‡Æø‡Æï‡Øç‡Æï‡Øà‡Æï‡Æ≥‡Øç',
                'schemes': '‡Æ§‡Æø‡Æü‡Øç‡Æü‡Æô‡Øç‡Æï‡Æ≥‡Øç',
                'enter_data': '‡Æ§‡Æ∞‡Æµ‡ØÅ ‡Æâ‡Æ≥‡Øç‡Æ≥‡Æø‡Æü‡Æµ‡ØÅ‡ÆÆ‡Øç',
                'not_specified': '‡Æï‡ØÅ‡Æ±‡Æø‡Æ™‡Øç‡Æ™‡Æø‡Æü‡Æ™‡Øç‡Æ™‡Æü‡Æµ‡Æø‡Æ≤‡Øç‡Æ≤‡Øà',
                'unknown': '‡Æ§‡ØÜ‡Æ∞‡Æø‡ÆØ‡Ææ‡Æ§',
                'unknown_status': '‡Æ§‡ØÜ‡Æ∞‡Æø‡ÆØ‡Ææ‡Æ§ ‡Æ®‡Æø‡Æ≤‡Øà',
                'unknown_village': '‡Æ§‡ØÜ‡Æ∞‡Æø‡ÆØ‡Ææ‡Æ§ ‡Æï‡Æø‡Æ∞‡Ææ‡ÆÆ‡ÆÆ‡Øç',
                'n_a': '‡Æï‡Æø‡Æü‡Øà‡Æï‡Øç‡Æï‡Æµ‡Æø‡Æ≤‡Øç‡Æ≤‡Øà',
                'states': '‡ÆÆ‡Ææ‡Æ®‡Æø‡Æ≤‡Æô‡Øç‡Æï‡Æ≥‡Øç',
                'loading_recommendations': '‡Æ™‡Æ∞‡Æø‡Æ®‡Øç‡Æ§‡ØÅ‡Æ∞‡Øà‡Æï‡Æ≥‡Øç ‡Æè‡Æ±‡Øç‡Æ±‡Æ™‡Øç‡Æ™‡Æü‡ØÅ‡Æï‡Æø‡Æ©‡Øç‡Æ±‡Æ©...',
                'loading_mpr_data': 'MPR ‡Æ§‡Æ∞‡Æµ‡ØÅ ‡Æè‡Æ±‡Øç‡Æ±‡Æ™‡Øç‡Æ™‡Æü‡ØÅ‡Æï‡Æø‡Æ±‡Æ§‡ØÅ...',
                'error_loading_mpr': 'MPR ‡Æ§‡Æ∞‡Æµ‡ØÅ ‡Æè‡Æ±‡Øç‡Æ±‡ØÅ‡Æµ‡Æ§‡Æø‡Æ≤‡Øç ‡Æ™‡Æø‡Æ¥‡Øà',
                'error_loading_recommendations': '‡Æ™‡Æ∞‡Æø‡Æ®‡Øç‡Æ§‡ØÅ‡Æ∞‡Øà‡Æï‡Æ≥‡Øç ‡Æè‡Æ±‡Øç‡Æ±‡ØÅ‡Æµ‡Æ§‡Æø‡Æ≤‡Øç ‡Æ™‡Æø‡Æ¥‡Øà',
                'view_detailed_analytics': '‡Æµ‡Æø‡Æ∞‡Æø‡Æµ‡Ææ‡Æ© ‡Æ™‡Æï‡ØÅ‡Æ™‡Øç‡Æ™‡Ææ‡ÆØ‡Øç‡Æµ‡ØÅ ‡Æ™‡Ææ‡Æ∞‡Øç‡Æï‡Øç‡Æï‡Æµ‡ØÅ‡ÆÆ‡Øç'
            }
        };

        // Simple language change function
        function changeLanguageDirect(lang) {
            console.log('üåê Changing to language:', lang);
            
            // Set global language state
            currentGlobalLanguage = lang;
            
            // Set cookie
            document.cookie = `lang=${lang}; path=/; max-age=${60*60*24*365}`;
            
            // Store in sessionStorage for consistency
            sessionStorage.setItem('currentLanguage', lang);
            
            // Get translations
            const langTranslations = translations[lang] || translations['en'];
            
            // Update all elements directly
            updateAllElements(langTranslations);
            
            // Force reload all dynamic content
            forceReloadAllContent(langTranslations);
            
            // Force complete regeneration of all content
            setTimeout(() => {
                forceCompleteRegeneration(langTranslations);
            }, 200);
            
            console.log('‚úÖ Language changed to:', lang);
        }

        // Get current language consistently
        function getCurrentLanguage() {
            // Use global language state if set
            if (currentGlobalLanguage !== 'en') return currentGlobalLanguage;
            
            // First check sessionStorage
            const sessionLang = sessionStorage.getItem('currentLanguage');
            if (sessionLang) {
                currentGlobalLanguage = sessionLang;
                return sessionLang;
            }
            
            // Then check cookie
            const cookies = document.cookie.split(';');
            for (let cookie of cookies) {
                const [name, value] = cookie.trim().split('=');
                if (name === 'lang') {
                    currentGlobalLanguage = value;
                    return value;
                }
            }
            
            // Default to English
            return 'en';
        }

        // Update all elements with translations
        function updateAllElements(t) {
            // Navbar elements
            updateText('nav-ai-predictions', t.ai_predictions);
            updateText('nav-analytics', t.analytics);
            updateText('nav-reports', t.reports);
            updateText('nav-schemes', t.schemes);
            updateText('nav-enter-data', t.enter_data);
            
            // Tab buttons
            updateText('tab-overview-text', t.overview);
            updateText('tab-progress-text', t.progress);
            updateText('tab-analytics-text', t.analytics);
            updateText('tab-export-text', t.export);
            
            // MPR Snapshot
            updateText('mpr-snapshot-title', t.mpr_snapshot);
            updateText('refresh-btn-text', t.refresh);
            
            // Village Information
            updateText('village-info-title', t.village_information);
            
            // Land Use Statistics
            updateText('land-stats-title', t.land_use_statistics);
            
            // Recommendations
            updateText('recommendations-title', t.smart_recommendations);
            
            // Update detailed analytics button
            const analyticsButton = document.querySelector('a[href*="detailed-analytics"]');
            if (analyticsButton) {
                analyticsButton.innerHTML = `<span>üìä</span> ${t.view_detailed_analytics || 'View Detailed Analytics'}`;
            }
            
            // Update MPR data
            updateMPRData(t);
            
            // Update village info if exists
            updateVillageInfo(t);
            
            // Reload statistics with new language
            reloadStatistics(t);
            
            console.log('‚úÖ All elements updated');
        }

        // Helper function to update text
        function updateText(id, text) {
            const element = document.getElementById(id);
            if (element && text) {
                element.textContent = text;
            }
        }

        // Helper function to translate status values
        function translateStatus(status, t) {
            if (!status) return t.unknown_status || 'Unknown Status';
            
            const statusLower = status.toLowerCase();
            if (statusLower.includes('approved') || statusLower.includes('approve')) {
                return t.approved || 'Approved';
            } else if (statusLower.includes('pending')) {
                return t.pending || 'Pending';
            } else if (statusLower.includes('verified')) {
                return t.verified || 'Verified';
            } else {
                return status; // Return original if no match
            }
        }

        // Update MPR data with translations
        function updateMPRData(t) {
            const mprData = document.getElementById('mprSnapshotData');
            if (mprData && !mprData.innerHTML.includes('Loading')) {
                const content = mprData.innerHTML;
                if (content.includes('States:')) {
                    mprData.innerHTML = content
                        .replace(/States:/g, t.states + ':')
                        .replace(/Total Claims:/g, t.total_claims + ':')
                        .replace(/Granted:/g, t.granted + ':')
                        .replace(/Area Vested:/g, t.area_vested + ':')
                        .replace(/Last Updated:/g, t.last_updated + ':');
                }
            }
        }

        // Update village information with translations
        function updateVillageInfo(t) {
            const villageContainer = document.getElementById('village-info');
            if (villageContainer && !villageContainer.classList.contains('loading')) {
                const content = villageContainer.innerHTML;
                if (content && !content.includes('Loading')) {
                    villageContainer.innerHTML = content
                        .replace(/Patta Holder/g, t.patta_holder)
                        .replace(/Land Area/g, t.land_area)
                        .replace(/Claim Status/g, t.claim_status)
                        .replace(/Coordinates/g, t.location)
                        .replace(/Forest Rights Village/g, t.forest_rights_village)
                        .replace(/ha/g, t.hectares);
                }
            }
        }

        // Reload statistics with new language
        function reloadStatistics(t) {
            const statsContainer = document.getElementById('land-stats');
            if (statsContainer && !statsContainer.innerHTML.includes('Loading')) {
                const content = statsContainer.innerHTML;
                if (content && content.includes('Farmland')) {
                    // Update existing statistics with new language
                    statsContainer.innerHTML = content
                        .replace(/Farmland/g, t.farmland)
                        .replace(/Forest/g, t.forest)
                        .replace(/Homestead/g, t.homestead)
                        .replace(/Water/g, t.water)
                        .replace(/pixels/g, t.pixels);
                }
            }
        }

        // Force reload all dynamic content with new language
        function forceReloadAllContent(t) {
            console.log('üîÑ Force reloading all content with language:', currentGlobalLanguage);
            
            // Force reload MPR snapshot
            setTimeout(() => {
                loadMPRSnapshot();
            }, 100);
            
            // Force reload statistics if they exist
            const statsContainer = document.getElementById('land-stats');
            if (statsContainer && !statsContainer.innerHTML.includes('Loading')) {
                const content = statsContainer.innerHTML;
                if (content && (content.includes('Farmland') || content.includes('‡Æµ‡Æø‡Æµ‡Æö‡Ææ‡ÆØ') || content.includes('‡§ï‡•É‡§∑‡§ø'))) {
                    // Completely regenerate statistics with new language
                    const mockStats = {
                        farmland: { percentage: 35.5, pixels: 3550 },
                        forest: { percentage: 42.3, pixels: 4230 },
                        homestead: { percentage: 14.4, pixels: 1440 },
                        water: { percentage: 7.8, pixels: 780 }
                    };
                    displayStatistics(mockStats);
                }
            }
            
            // Force reload village info with better extraction
            const villageContainer = document.getElementById('village-info');
            if (villageContainer && !villageContainer.classList.contains('loading')) {
                const content = villageContainer.innerHTML;
                if (content && !content.includes('Loading')) {
                    // Extract existing data with better regex patterns
                    const villageName = content.match(/<h3>(.*?)<\/h3>/)?.[1] || 'Unknown Village';
                    
                    // Extract patta holder - handle multiple language patterns
                    let pattaHolder = 'Not specified';
                    const pattaMatch = content.match(/(?:Patta Holder|‡§™‡§ü‡•ç‡§ü‡§æ ‡§ß‡§æ‡§∞‡§ï|‡Æ™‡Æü‡Øç‡Æü‡Ææ ‡Æµ‡Øà‡Æ§‡Øç‡Æ§‡Æø‡Æ∞‡ØÅ‡Æ™‡Øç‡Æ™‡Æµ‡Æ∞‡Øç)[^>]*>([^<]*)/);
                    if (pattaMatch) pattaHolder = pattaMatch[1];
                    
                    // Extract area - handle multiple language patterns
                    let areaHectares = 'Not specified';
                    const areaMatch = content.match(/(\d+\.?\d*)\s*(?:ha|‡§π‡•á‡§ï‡•ç‡§ü‡•á‡§Ø‡§∞|‡Æπ‡ØÜ‡Æï‡Øç‡Æü‡Øá‡Æ∞‡Øç)/);
                    if (areaMatch) areaHectares = areaMatch[1];
                    
                    // Extract claim status
                    let claimStatus = 'Unknown';
                    const statusMatch = content.match(/(?:Claim Status|‡§¶‡§æ‡§µ‡§æ ‡§∏‡•ç‡§•‡§ø‡§§‡§ø|‡Æï‡Øã‡Æ∞‡Æø‡Æï‡Øç‡Æï‡Øà ‡Æ®‡Æø‡Æ≤‡Øà)[^>]*>([^<]*)/);
                    if (statusMatch) claimStatus = statusMatch[1];
                    
                    // Extract coordinates
                    let coordinates = 'N/A, N/A';
                    const coordMatch = content.match(/(?:Coordinates|‡§∏‡•ç‡§•‡§æ‡§®|‡Æá‡Æü‡ÆÆ‡Øç)[^>]*>([^<]*)/);
                    if (coordMatch) coordinates = coordMatch[1];
                    
                    // Regenerate with new language
                    villageContainer.innerHTML = `
                        <div class="village-card">
                            <div class="village-header">
                                <div class="village-avatar">üèòÔ∏è</div>
                                <div class="village-details">
                                    <h3>${villageName}</h3>
                                    <p>${t.forest_rights_village || 'Forest Rights Village'} ‚Ä¢ ${translateStatus(claimStatus, t)}</p>
                                </div>
                            </div>
                            
                            <div style="display: grid; gap: 14px;">
                                <div class="stat-item">
                                    <span class="stat-label">
                                        <span>üë§</span> ${t.patta_holder || 'Patta Holder'}
                                    </span>
                                    <span class="stat-value">${pattaHolder || t.not_specified || 'Not specified'}</span>
                                </div>
                                <div class="stat-item">
                                    <span class="stat-label">
                                        <span>üìè</span> ${t.land_area || 'Land Area'}
                                    </span>
                                    <span class="stat-value">${areaHectares || t.not_specified || 'Not specified'} ${t.hectares || 'ha'}</span>
                                </div>
                                <div class="stat-item">
                                    <span class="stat-label">
                                        <span>‚úÖ</span> ${t.claim_status || 'Claim Status'}
                                    </span>
                                    <span class="stat-value" style="color: #28a745;">${translateStatus(claimStatus, t)}</span>
                                </div>
                                <div class="stat-item">
                                    <span class="stat-label">
                                        <span>üìç</span> ${t.location || 'Coordinates'}
                                    </span>
                                    <span class="stat-value">${coordinates || t.n_a || 'N/A'}</span>
                                </div>
                            </div>
                        </div>
                    `;
                }
            }
            
            console.log('‚úÖ All content force reloaded');
        }

        // Force complete regeneration of all content
        function forceCompleteRegeneration(t) {
            console.log('üîÑ Force complete regeneration with language:', currentGlobalLanguage);
            
            // Force regenerate village info completely
            const villageContainer = document.getElementById('village-info');
            if (villageContainer) {
                // Create mock village data with current language
                const mockVillageData = {
                    village: 'Khargone',
                    patta_holder: 'Ram Singh',
                    area_hectares: '2.5',
                    claim_status: 'Approved',
                    latitude: 21.8225,
                    longitude: 75.6102
                };
                
                // Regenerate village info with new language
                villageContainer.innerHTML = `
                    <div class="village-card">
                        <div class="village-header">
                            <div class="village-avatar">üèòÔ∏è</div>
                            <div class="village-details">
                                <h3>${mockVillageData.village}</h3>
                                <p>${t.forest_rights_village || 'Forest Rights Village'} ‚Ä¢ ${translateStatus(mockVillageData.claim_status, t)}</p>
                            </div>
                        </div>
                        
                        <div style="display: grid; gap: 14px;">
                            <div class="stat-item">
                                <span class="stat-label">
                                    <span>üë§</span> ${t.patta_holder || 'Patta Holder'}
                                </span>
                                <span class="stat-value">${mockVillageData.patta_holder || t.not_specified || 'Not specified'}</span>
                            </div>
                            <div class="stat-item">
                                <span class="stat-label">
                                    <span>üìè</span> ${t.land_area || 'Land Area'}
                                </span>
                                <span class="stat-value">${mockVillageData.area_hectares || t.not_specified || 'Not specified'} ${t.hectares || 'ha'}</span>
                            </div>
                            <div class="stat-item">
                                <span class="stat-label">
                                    <span>‚úÖ</span> ${t.claim_status || 'Claim Status'}
                                </span>
                                <span class="stat-value" style="color: #28a745;">${translateStatus(mockVillageData.claim_status, t)}</span>
                            </div>
                            <div class="stat-item">
                                <span class="stat-label">
                                    <span>üìç</span> ${t.location || 'Coordinates'}
                                </span>
                                <span class="stat-value">${mockVillageData.latitude ? mockVillageData.latitude.toFixed(4) : t.n_a || 'N/A'}, ${mockVillageData.longitude ? mockVillageData.longitude.toFixed(4) : t.n_a || 'N/A'}</span>
                            </div>
                        </div>
                    </div>
                `;
            }
            
            // Force regenerate statistics completely
            const statsContainer = document.getElementById('land-stats');
            if (statsContainer) {
                const mockStats = {
                    farmland: { percentage: 35.5, pixels: 3550 },
                    forest: { percentage: 42.3, pixels: 4230 },
                    homestead: { percentage: 14.4, pixels: 1440 },
                    water: { percentage: 7.8, pixels: 780 }
                };
                displayStatistics(mockStats);
            }
            
            // Force regenerate MPR data
            setTimeout(() => {
                loadMPRSnapshot();
            }, 100);
            
            console.log('‚úÖ Complete regeneration finished');
        }

        
        // Language switching now handled by Flask-Babel system
        
        // Language initialization handled by Flask-Babel system

        // Admin dropdown functionality
        function toggleAdminDropdown() {
            const menu = document.getElementById('admin-menu');
            const arrow = document.querySelector('.dropdown-arrow');
            
            if (menu.classList.contains('show')) {
                menu.classList.remove('show');
                arrow.style.transform = 'rotate(0deg)';
            } else {
                menu.classList.add('show');
                arrow.style.transform = 'rotate(180deg)';
            }
        }

        // Close dropdown when clicking outside
        document.addEventListener('click', function(event) {
            const dropdown = document.querySelector('.admin-dropdown');
            if (dropdown && !dropdown.contains(event.target)) {
                const menu = document.getElementById('admin-menu');
                const arrow = document.querySelector('.dropdown-arrow');
                menu.classList.remove('show');
                arrow.style.transform = 'rotate(0deg)';
            }
        });

        // AI Features
        function showAIPredictions() {
            alert('üîÆ AI Predictions Panel\n\n‚Ä¢ Forest Health Forecast\n‚Ä¢ Deforestation Risk Analysis\n‚Ä¢ Tribal Settlement Growth\n‚Ä¢ Climate Impact Predictions\n‚Ä¢ Resource Availability Trends');
        }

        function showAnalytics() {
            alert('üìä Advanced Analytics\n\n‚Ä¢ Real-time Data Visualization\n‚Ä¢ Interactive Charts & Graphs\n‚Ä¢ Trend Analysis\n‚Ä¢ Performance Metrics\n‚Ä¢ Custom Reports');
        }

        function generateReports() {
            alert('üìà Report Generation\n\n‚Ä¢ Automated FRA Reports\n‚Ä¢ Custom Analytics\n‚Ä¢ Export Options (PDF, Excel)\n‚Ä¢ Scheduled Reports\n‚Ä¢ Data Insights');
        }
        
        class FRAAtlas {
            constructor() {
                this.map = null;
                this.fraLayer = null;
                this.currentMapLayer = null;
                this.mapLayers = {};
                this.init();
            }

            init() {
                console.log('üîß Initializing FRA Atlas Ultimate...');
                this.updateDebugStatus('Initializing...');
                this.initMap();
                this.initTabs();
                this.loadSystemData();
                this.forceUpdateVillageInfo(); // Force update village info with translations
            }

            getCurrentLanguage() {
                // Check if language is set in the page context (from Flask-Babel)
                const currentLangElement = document.querySelector('[data-current-lang]');
                if (currentLangElement) {
                    return currentLangElement.getAttribute('data-current-lang');
                }
                
                // Get language from URL parameter
                const urlParams = new URLSearchParams(window.location.search);
                const langParam = urlParams.get('lang');
                if (langParam) return langParam;
                
                // Check cookie
                const cookies = document.cookie.split(';');
                for (let cookie of cookies) {
                    const [name, value] = cookie.trim().split('=');
                    if (name === 'lang') return value;
                }
                
                // Check language selector dropdown
                const langSelector = document.querySelector('select[name="language"], .language-selector select');
                if (langSelector && langSelector.value) {
                    return langSelector.value;
                }
                
                // Check for Hindi indicators in the page
                if (document.body.textContent.includes('‡§π‡§ø‡§Ç‡§¶‡•Ä') || document.body.textContent.includes('‡§è‡§Ü‡§à')) {
                    return 'hindi';
                }
                
                return 'english'; // default
            }

            async getTranslations(language) {
                try {
                    const response = await fetch(`/api/translations/${language}`);
                    const translations = await response.json();
                    return translations;
                } catch (error) {
                    console.error('Error fetching translations:', error);
                    return {}; // Return empty object if translation fails
                }
            }

            async updateVillageInfoTitle() {
                const currentLang = this.getCurrentLanguage();
                const translations = await this.getTranslations(currentLang);
                const titleElement = document.getElementById('village-info-title');
                if (titleElement) {
                    titleElement.textContent = translations.village_information || 'Village Information';
                }
            }

            async forceUpdateVillageInfo() {
                console.log('üîÑ Force updating all content with translations...');
                const currentLang = this.getCurrentLanguage();
                console.log('üåê Current language detected:', currentLang);
                
                const translations = await this.getTranslations(currentLang);
                console.log('üìù Translations loaded:', translations);
                
                // Update tab buttons
                this.updateElementText('tab-overview-text', translations.overview);
                this.updateElementText('tab-progress-text', translations.progress);
                this.updateElementText('tab-analytics-text', translations.analytics);
                this.updateElementText('tab-export-text', translations.export);
                
                // Update overview tab content
                this.updateElementText('village-info-title', translations.village_information);
                this.updateElementText('land-stats-title', translations.land_use_statistics);
                this.updateElementText('recommendations-title', translations.smart_recommendations);
                
                // Update progress tab content
                this.updateElementText('progress-tracking-title', translations.progress);
                this.updateElementText('all-states-text', translations.states);
                this.updateElementText('ifr-claims-text', 'IFR ' + (translations.claims || 'Claims'));
                this.updateElementText('cr-claims-text', 'CR ' + (translations.claims || 'Claims'));
                this.updateElementText('cfr-claims-text', 'CFR ' + (translations.claims || 'Claims'));
                this.updateElementText('top-pending-title', translations.pending_claims);
                
                // Update analytics tab content
                this.updateElementText('system-analytics-title', translations.analytics);
                this.updateElementText('system-status-label', translations.system_uptime);
                this.updateElementText('villages-loaded-label', translations.villages);
                this.updateElementText('data-categories-label', translations.analytics);
                
                // Update export tab content
                this.updateElementText('export-options-title', translations.export);
                this.updateElementText('pdf-report-label', translations.export_pdf);
                this.updateElementText('excel-data-label', translations.export_excel);
                this.updateElementText('generate-pdf-btn', translations.generate_report);
                this.updateElementText('export-excel-btn', translations.export_data);
                
                // Update MPR snapshot content
                this.updateElementText('mpr-snapshot-title', translations.mpr_snapshot);
                this.updateElementText('loading-mpr-text', translations.loading_village_data);
                this.updateElementText('refresh-btn-text', translations.refresh);
                
                // Update land use statistics
                this.updateElementText('land-stats-title', translations.land_use_statistics);
                
                // Reload statistics with new language
                this.loadSystemData();
                
                // Reload MPR snapshot with new language
                loadMPRSnapshot();
                
                // Update village info content if it exists
                const villageContainer = document.getElementById('village-info');
                if (villageContainer && !villageContainer.classList.contains('loading')) {
                    const existingContent = villageContainer.innerHTML;
                    if (existingContent && !existingContent.includes('Loading')) {
                        // Re-render with translations
                        const villageName = existingContent.match(/<h3>(.*?)<\/h3>/)?.[1] || 'Unknown Village';
                        const pattaHolder = existingContent.match(/Patta Holder[^>]*>([^<]*)/)?.[1] || 'Not specified';
                        const areaHectares = existingContent.match(/(\d+\.?\d*)\s*ha/)?.[1] || 'Not specified';
                        const claimStatus = existingContent.match(/Claim Status[^>]*>([^<]*)/)?.[1] || 'Unknown';
                        const coordinates = existingContent.match(/Coordinates[^>]*>([^<]*)/)?.[1] || 'N/A, N/A';
                        
                        villageContainer.innerHTML = `
                            <div class="village-card">
                                <div class="village-header">
                                    <div class="village-avatar">üèòÔ∏è</div>
                                    <div class="village-details">
                                        <h3>${villageName}</h3>
                                        <p>${translations.forest_rights_village || 'Forest Rights Village'} ‚Ä¢ ${claimStatus}</p>
                                    </div>
                                </div>
                                
                                <div style="display: grid; gap: 14px;">
                                    <div class="stat-item">
                                        <span class="stat-label">
                                            <span>üë§</span> ${translations.patta_holder || 'Patta Holder'}
                                        </span>
                                        <span class="stat-value">${pattaHolder}</span>
                                    </div>
                                    <div class="stat-item">
                                        <span class="stat-label">
                                            <span>üìè</span> ${translations.land_area || 'Land Area'}
                                        </span>
                                        <span class="stat-value">${areaHectares} ${translations.hectares || 'ha'}</span>
                                    </div>
                                    <div class="stat-item">
                                        <span class="stat-label">
                                            <span>‚úÖ</span> ${translations.claim_status || 'Claim Status'}
                                        </span>
                                        <span class="stat-value" style="color: #28a745;">${claimStatus}</span>
                                    </div>
                                    <div class="stat-item">
                                        <span class="stat-label">
                                            <span>üìç</span> ${translations.location || 'Coordinates'}
                                        </span>
                                        <span class="stat-value">${coordinates}</span>
                                    </div>
                                </div>
                            </div>
                        `;
                    }
                }
                
                console.log('‚úÖ All content updated with translations!');
            }

            updateElementText(elementId, text) {
                const element = document.getElementById(elementId);
                if (element && text) {
                    element.textContent = text;
                }
            }

            updateLanguageSelector(lang) {
                const selector = document.getElementById('language-select');
                if (selector) {
                    selector.value = lang;
                }
            }

            updateDebugStatus(message) {
                const debugEl = document.getElementById('debug-status');
                if (debugEl) {
                    debugEl.textContent = `System: ${message}`;
                }
                console.log('üîÑ Status:', message);
            }

            initMap() {
                console.log('üó∫Ô∏è Initializing enhanced map...');
                
                this.map = L.map('map', {
                    center: [21.8225, 75.6102],
                    zoom: 10,
                    zoomControl: false
                });
                
                // Add zoom control
                L.control.zoom({
                    position: 'bottomright'
                }).addTo(this.map);
                
                // Define map layers
                this.mapLayers = {
                    street: L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                        attribution: '¬© OpenStreetMap contributors',
                        maxZoom: 18
                    }),
                    satellite: L.tileLayer('https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}', {
                        attribution: '¬© Esri, DigitalGlobe, GeoEye',
                        maxZoom: 18
                    }),
                    terrain: L.tileLayer('https://{s}.tile.opentopomap.org/{z}/{x}/{y}.png', {
                        attribution: '¬© OpenTopoMap contributors',
                        maxZoom: 15
                    })
                };
                
                // Add default street layer
                this.currentMapLayer = this.mapLayers.street;
                this.currentMapLayer.addTo(this.map);
                
                console.log('‚úÖ Enhanced map initialized with multiple layers');
                this.updateDebugStatus('Map Ready with Layer Controls');
            }

            initTabs() {
                const tabButtons = document.querySelectorAll('.tab-button');
                const tabPanes = document.querySelectorAll('.tab-pane');

                tabButtons.forEach(button => {
                    button.addEventListener('click', () => {
                        const target = button.getAttribute('data-tab');
                        
                        tabButtons.forEach(btn => btn.classList.remove('active'));
                        button.classList.add('active');
                        
                        tabPanes.forEach(pane => pane.classList.remove('active'));
                        document.getElementById(target).classList.add('active');
                        
                        console.log('üìë Switched to tab:', target);
                    });
                });
            }

            async loadSystemData() {
                console.log('üìä Loading system data...');
                this.updateDebugStatus('Loading Data...');
                
                try {
                    // Load system status
                    const statusResponse = await fetch('/api/system_status');
                    if (!statusResponse.ok) throw new Error(`Status API failed: ${statusResponse.status}`);
                    const statusData = await statusResponse.json();
                    console.log('‚úÖ System status loaded:', statusData);
                    this.updateSystemStatus(statusData);
                    
                    // Load FRA data
                    const fraResponse = await fetch('/api/fra_data');
                    if (!fraResponse.ok) throw new Error(`FRA API failed: ${fraResponse.status}`);
                    const fraData = await fraResponse.json();
                    if (fraData.error) throw new Error(fraData.error);
                    console.log('‚úÖ FRA data loaded:', fraData);
                    this.displayFRAData(fraData);
                    
                    // Load statistics
                    const statsResponse = await fetch('/api/classification_stats');
                    if (!statsResponse.ok) throw new Error(`Stats API failed: ${statsResponse.status}`);
                    const statsData = await statsResponse.json();
                    console.log('‚úÖ Statistics loaded:', statsData);
                    this.displayStatistics(statsData);
                    
                    this.updateDebugStatus('‚úÖ All Data Loaded Successfully');
                    
                    // Auto-select first village
                    if (fraData.features && fraData.features.length > 0) {
                        setTimeout(() => {
                            console.log('üéØ Auto-selecting first village...');
                            this.selectVillage(fraData.features[0].properties);
                        }, 1000);
                    }
                    
                } catch (error) {
                    console.error('üí• Error loading data:', error);
                    this.updateDebugStatus('‚ùå Error: ' + error.message);
                }
            }

            updateSystemStatus(statusData) {
                document.getElementById('system-status').textContent = statusData.status || 'Unknown';
                document.getElementById('villages-count').textContent = statusData.villages_loaded || 0;
                document.getElementById('stats-count').textContent = statusData.stats_loaded || 0;
            }

            displayFRAData(data) {
                console.log('üèòÔ∏è Displaying FRA data with enhanced markers...');
                
                if (!data.features || data.features.length === 0) {
                    console.error('‚ùå No villages found');
                    return;
                }

                if (this.fraLayer) {
                    this.map.removeLayer(this.fraLayer);
                }

                this.fraLayer = L.geoJSON(data, {
                    pointToLayer: (feature, latlng) => {
                        return L.circleMarker(latlng, {
                            radius: 16,
                            fillColor: "#1e3c72",
                            color: "#ffffff",
                            weight: 4,
                            opacity: 1,
                            fillOpacity: 0.9
                        });
                    },
                    onEachFeature: (feature, layer) => {
                        const props = feature.properties;
                        
                        const popupContent = `
                            <div style="font-family: 'Inter', sans-serif; padding: 20px; min-width: 280px; background: linear-gradient(135deg, #ffffff 0%, #f8f9fa 100%); border-radius: 12px;">
                                <div style="display: flex; align-items: center; gap: 15px; margin-bottom: 20px;">
                                    <div style="width: 50px; height: 50px; background: linear-gradient(135deg, #1e3c72, #2a5298); border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 1.5em; color: white; box-shadow: 0 4px 15px rgba(30, 60, 114, 0.3);">üèòÔ∏è</div>
                                    <div>
                                        <h4 style="margin: 0; background: linear-gradient(135deg, #1e3c72, #4a7c59); -webkit-background-clip: text; -webkit-text-fill-color: transparent; font-size: 1.4em;">${props.village}</h4>
                                        <p style="margin: 4px 0 0 0; color: #666; font-size: 0.95em;">Forest Rights Village</p>
                                    </div>
                                </div>
                                
                                <div style="background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%); padding: 16px; border-radius: 10px; margin: 15px 0;">
                                    <p style="margin: 6px 0; color: #333;"><strong>üßë‚Äçüåæ Patta Holder:</strong> ${props.patta_holder || 'Not specified'}</p>
                                    <p style="margin: 6px 0; color: #333;"><strong>üìè Land Area:</strong> ${props.area_hectares || 'Not specified'} hectares</p>
                                    <p style="margin: 6px 0; color: #333;"><strong>‚úÖ Status:</strong> <span style="color: #28a745; font-weight: 600;">${props.claim_status || 'Unknown'}</span></p>
                                    <p style="margin: 6px 0; color: #333;"><strong>üìç Location:</strong> ${props.latitude ? props.latitude.toFixed(4) : 'N/A'}, ${props.longitude ? props.longitude.toFixed(4) : 'N/A'}</p>
                                    ${props.tribal_group ? `<p style="margin: 6px 0; color: #333;"><strong>üèõÔ∏è Tribal Group:</strong> ${props.tribal_group}</p>` : ''}
                                    ${props.family_size ? `<p style="margin: 6px 0; color: #333;"><strong>üë• Family Size:</strong> ${props.family_size} members</p>` : ''}
                                    ${props.file_id ? `<p style="margin: 6px 0; color: #333;"><strong>üìÑ File ID:</strong> ${props.file_id}</p>` : ''}
                                    ${props.uploaded_by ? `<p style="margin: 6px 0; color: #333;"><strong>üë§ Uploaded by:</strong> ${props.uploaded_by}</p>` : ''}
                                </div>
                                
                                <button onclick="window.location.href='/detailed-analytics'" 
                                        style="background: linear-gradient(135deg, #1e3c72, #4a7c59); color: white; border: none; padding: 12px 24px; border-radius: 8px; cursor: pointer; width: 100%; font-size: 1em; font-weight: 500; transition: all 0.3s ease;">
                                    üìä View Detailed Analysis
                                </button>
                            </div>
                        `;
                        
                        layer.bindPopup(popupContent, {
                            maxWidth: 320,
                            className: 'custom-popup'
                        });
                        
                        layer.on('click', () => {
                            console.log('üîç Village clicked:', props.village);
                            this.selectVillage(props);
                        });
                        
                        // Enhanced hover effects
                        layer.on('mouseover', function() {
                            this.setStyle({ fillOpacity: 1, radius: 20 });
                        });
                        
                        layer.on('mouseout', function() {
                            this.setStyle({ fillOpacity: 0.9, radius: 16 });
                        });
                    }
                });
                
                this.fraLayer.addTo(this.map);
                this.map.fitBounds(this.fraLayer.getBounds(), { padding: [40, 40] });
                
                console.log(`‚úÖ Displayed ${data.features.length} villages with enhanced styling`);
            }

           async displayStatistics(stats) {
    console.log('üìà Displaying enhanced statistics...');
    
    const container = document.getElementById('land-stats');
    if (!container) return;
    
    // Get current language consistently
    const currentLang = getCurrentLanguage();
    
    // Get translations for current language
    const t = translations[currentLang] || translations['en'];
    
    const icons = {
        'farmland': 'üåæ',
        'forest': 'üå≤', 
        'water': 'üíß',
        'homestead': 'üè†'
    };

    let html = '<div class="stats-grid">';
    Object.entries(stats).forEach(([type, data], index) => {
        const icon = icons[type] || 'üìä';
        const translatedType = t[type] || type.charAt(0).toUpperCase() + type.slice(1);
        const pixelsText = t.pixels || 'pixels';
        
        html += `
            <div class="stat-item" style="animation: slideUp 0.5s ease ${index * 0.1}s both;">
                <div class="stat-label">
                    <span class="stat-icon">${icon}</span>
                    <span>${translatedType}</span>
                </div>
                <div class="stat-value-container">
                    <div class="stat-value">${data.percentage}%</div>
                    <div class="stat-subtext">${data.pixels.toLocaleString()} ${pixelsText}</div>
                </div>
            </div>
        `;
    });
    html += '</div>';
    
    container.innerHTML = html;
    console.log('‚úÖ Perfect statistics displayed');
}


            async selectVillage(props) {
                console.log('üéØ Selecting village with enhanced display:', props);
                
                const villageName = props.village || 'Unknown Village';
                this.updateDebugStatus(`Analyzing ${villageName}...`);
                
                // Get current language and translations using our simple system
                const currentLang = getCurrentLanguage();
                const t = translations[currentLang] || translations['en'];
                
                // Enhanced village info display with translations
                const villageContainer = document.getElementById('village-info');
                villageContainer.innerHTML = `
                    <div class="village-card">
                        <div class="village-header">
                            <div class="village-avatar">üèòÔ∏è</div>
                            <div class="village-details">
                                <h3>${villageName}</h3>
                                <p>${t.forest_rights_village || 'Forest Rights Village'} ‚Ä¢ ${translateStatus(props.claim_status, t)}</p>
                            </div>
                        </div>
                        
                        <div style="display: grid; gap: 14px;">
                            <div class="stat-item">
                                <span class="stat-label">
                                    <span>üë§</span> ${t.patta_holder || 'Patta Holder'}
                                </span>
                                <span class="stat-value">${props.patta_holder || t.not_specified || 'Not specified'}</span>
                            </div>
                            <div class="stat-item">
                                <span class="stat-label">
                                    <span>üìè</span> ${t.land_area || 'Land Area'}
                                </span>
                                <span class="stat-value">${props.area_hectares || t.not_specified || 'Not specified'} ${t.hectares || 'ha'}</span>
                            </div>
                            <div class="stat-item">
                                <span class="stat-label">
                                    <span>‚úÖ</span> ${t.claim_status || 'Claim Status'}
                                </span>
                                <span class="stat-value" style="color: #28a745;">${translateStatus(props.claim_status, t)}</span>
                            </div>
                            <div class="stat-item">
                                <span class="stat-label">
                                    <span>üìç</span> ${t.location || 'Coordinates'}
                                </span>
                                <span class="stat-value">${props.latitude ? props.latitude.toFixed(4) : t.n_a || 'N/A'}, ${props.longitude ? props.longitude.toFixed(4) : t.n_a || 'N/A'}</span>
                            </div>
                        </div>
                    </div>
                `;
                
                // Load recommendations
                try {
                    console.log('üîÑ Loading enhanced recommendations...');
                    document.getElementById('recommendations').innerHTML = '<div class="loading">Loading recommendations...</div>';
                    
                    const encodedVillage = encodeURIComponent(villageName);
                    const recResponse = await fetch(`/api/dss_recommendation/${encodedVillage}`);
                    if (!recResponse.ok) throw new Error(`API failed: ${recResponse.status}`);
                    
                    const recData = await recResponse.json();
                    if (recData.error) throw new Error(recData.error);
                    
                    console.log('‚úÖ Enhanced recommendations loaded:', recData);
                    this.displayRecommendations(recData);
                    this.updateDebugStatus(`‚úÖ ${villageName} Analysis Complete`);
                    
                } catch (error) {
                    console.error('üí• Error loading recommendations:', error);
                    document.getElementById('recommendations').innerHTML = `
                        <div style="background: linear-gradient(135deg, #f8d7da, #f1aeb5); color: #721c24; padding: 20px; border-radius: 12px; border-left: 4px solid #dc3545;">
                            <strong>‚ùå Failed to load recommendations:</strong><br>
                            ${error.message}
                        </div>
                    `;
                }
            }

            displayRecommendations(data) {
                console.log('üéØ Displaying enhanced recommendations...');
                
                const container = document.getElementById('recommendations');
                
                if (!data.recommendations || data.recommendations.length === 0) {
                    container.innerHTML = `
                        <div style="text-align: center; padding: 50px; background: var(--card-gradient); border-radius: var(--border-radius);">
                            <div style="font-size: 4em; margin-bottom: 20px;">üéØ</div>
                            <h4 style="background: var(--primary-gradient); -webkit-background-clip: text; -webkit-text-fill-color: transparent; margin-bottom: 12px;">All Schemes Optimized</h4>
                            <p style="color: var(--text-secondary);">Current scheme distribution is optimal for this village.</p>
                        </div>
                    `;
                    return;
                }

                let html = '';
                data.recommendations.forEach((rec, index) => {
                    const priorityIcons = { 'High': 'üî•', 'Medium': '‚ö°', 'Low': 'üìù' };
                    const priorityIcon = priorityIcons[rec.priority] || 'üìã';
                    
                    html += `
                        <div class="recommendation-item" style="animation-delay: ${index * 0.15}s;">
                            <div class="scheme-header">
                                <div class="scheme-name">
                                    <span class="scheme-icon">${priorityIcon}</span>
                                    <span>${rec.scheme}</span>
                                </div>
                                <span class="priority priority-${(rec.priority || 'medium').toLowerCase()}">${rec.priority || 'Medium'} Priority</span>
                            </div>
                            
                            <div style="margin: 20px 0; color: var(--text-secondary); line-height: 1.6;">
                                <p style="margin: 10px 0;"><strong style="color: var(--text-primary);">üí∞ Benefit:</strong> ${rec.benefit}</p>
                                <p style="margin: 10px 0;"><strong style="color: var(--text-primary);">üèõÔ∏è Ministry:</strong> ${rec.ministry}</p>
                                
                                <div style="margin: 20px 0;">
                                    <strong style="color: var(--text-primary);">‚úì Eligibility Reasons:</strong>
                                    <div style="margin-top: 12px;">
                                        ${rec.reasons.map(reason => `
                                            <div style="display: flex; align-items: center; gap: 12px; margin: 8px 0; padding: 12px 16px; background: var(--success-gradient); background: linear-gradient(135deg, #e8f5e8, #f1f8e9); border-radius: 8px; border-left: 4px solid #4caf50;">
                                                <span style="color: #4caf50; font-weight: 600;">‚úì</span>
                                                <span style="color: var(--text-primary);">${reason}</span>
                                            </div>
                                        `).join('')}
                                    </div>
                                </div>
                                
                                <!-- Eligibility score display removed -->
                            </div>
                        </div>
                    `;
                });
                
                container.innerHTML = html;
                console.log(`‚úÖ Displayed ${data.recommendations.length} enhanced recommendations`);
            }
        }

        // Global functions for map controls
        function switchMapLayer(layerType) {
            console.log('üó∫Ô∏è Switching to', layerType, 'layer');
            
            if (window.fraAtlas && window.fraAtlas.currentMapLayer) {
                window.fraAtlas.map.removeLayer(window.fraAtlas.currentMapLayer);
            }
            
            window.fraAtlas.currentMapLayer = window.fraAtlas.mapLayers[layerType];
            window.fraAtlas.currentMapLayer.addTo(window.fraAtlas.map);
            
            // Update button states
            document.querySelectorAll('#street-view, #satellite-view, #terrain-view').forEach(btn => btn.classList.remove('active'));
            document.getElementById(layerType + '-view').classList.add('active');
            
            window.fraAtlas.updateDebugStatus(`Map: ${layerType.charAt(0).toUpperCase() + layerType.slice(1)} View Active`);
        }

        function resetMapView() {
            if (window.fraAtlas && window.fraAtlas.map) {
                window.fraAtlas.map.setView([21.8225, 75.6102], 10);
                console.log('üè† Map view reset to default');
            }
        }

        function toggleFullscreen() {
            const mapContainer = document.querySelector('.map-container');
            if (document.fullscreenElement) {
                document.exitFullscreen();
            } else {
                mapContainer.requestFullscreen();
            }
        }

        // Boundary layer management
        let boundaryLayers = {};
        
        async function toggleBoundaryLayer(layerType) {
            const button = document.getElementById(layerType + '-layer');
            const isActive = button.classList.contains('active');
            
            if (isActive) {
                // Remove layer
                if (boundaryLayers[layerType]) {
                    window.fraAtlas.map.removeLayer(boundaryLayers[layerType]);
                    delete boundaryLayers[layerType];
                }
                button.classList.remove('active');
            } else {
                // Add layer
                try {
                    const response = await fetch(`/api/boundaries/${layerType}`);
                    const data = await response.json();
                    
                    const layer = L.geoJSON(data, {
                        style: getBoundaryStyle(layerType),
                        onEachFeature: function(feature, layer) {
                            const props = feature.properties;
                            const popupContent = `
                                <div style="font-family: 'Inter', sans-serif; padding: 15px; min-width: 200px;">
                                    <h4 style="margin: 0 0 10px 0; color: #1b5e20;">${props.name || 'Unknown'}</h4>
                                    ${props.type ? `<p style="margin: 5px 0; color: #333;"><strong>Type:</strong> ${props.type}</p>` : ''}
                                    ${props.state ? `<p style="margin: 5px 0; color: #333;"><strong>State:</strong> ${props.state}</p>` : ''}
                                    ${props.tribe ? `<p style="margin: 5px 0; color: #333;"><strong>Tribe:</strong> ${props.tribe}</p>` : ''}
                                    <div style="margin-top: 10px; padding-top: 10px; border-top: 1px solid #eee;">
                                        <small style="color: #666;">Click to highlight ‚Ä¢ Hover for details</small>
                                    </div>
                                </div>
                            `;
                            layer.bindPopup(popupContent);
                            
                            // Add hover effects
                            layer.on('mouseover', function(e) {
                                this.setStyle(getHighlightStyle(layerType));
                                this.bringToFront();
                            });
                            
                            layer.on('mouseout', function(e) {
                                this.setStyle(getBoundaryStyle(layerType));
                            });
                            
                            // Add click-to-highlight functionality
                            layer.on('click', function(e) {
                                // Remove highlight from all other features in this layer
                                layer.eachLayer(function(layer) {
                                    layer.setStyle(getBoundaryStyle(layerType));
                                });
                                
                                // Highlight clicked feature
                                this.setStyle(getHighlightStyle(layerType));
                                this.bringToFront();
                                
                                // Show popup
                                this.openPopup();
                                
                                console.log(`üéØ Highlighted ${props.name || 'Unknown'} (${props.type || 'Unknown Type'})`);
                            });
                        }
                    });
                    
                    layer.addTo(window.fraAtlas.map);
                    boundaryLayers[layerType] = layer;
                    button.classList.add('active');
                    
                    console.log(`‚úÖ ${layerType} boundary layer loaded`);
                } catch (error) {
                    console.error(`‚ùå Failed to load ${layerType} layer:`, error);
                }
            }
        }
        
        function getBoundaryStyle(layerType) {
            const styles = {
                'states': {
                    color: '#1E3A8A',  // Dark Blue
                    weight: 3,
                    opacity: 0.8,
                    fillColor: '#1E3A8A',
                    fillOpacity: 0.2,
                    dashArray: '10, 5'
                },
                'districts': {
                    color: '#F97316',  // Orange
                    weight: 2,
                    opacity: 0.7,
                    fillColor: '#F97316',
                    fillOpacity: 0.15,
                    dashArray: '8, 4'
                },
                'villages': {
                    color: '#10B981',  // Light Green
                    weight: 1.5,
                    opacity: 0.6,
                    fillColor: '#10B981',
                    fillOpacity: 0.2,
                    dashArray: '5, 3'
                },
                'tribal_areas': {
                    color: '#DC2626',  // Red
                    weight: 2.5,
                    opacity: 0.8,
                    fillColor: '#DC2626',
                    fillOpacity: 0.25,
                    dashArray: '12, 6'
                }
            };
            return styles[layerType] || styles['states'];
        }
        
        function getHighlightStyle(layerType) {
            const styles = {
                'states': {
                    color: '#1E3A8A',
                    weight: 4,
                    opacity: 1,
                    fillColor: '#1E3A8A',
                    fillOpacity: 0.4
                },
                'districts': {
                    color: '#F97316',
                    weight: 3,
                    opacity: 1,
                    fillColor: '#F97316',
                    fillOpacity: 0.3
                },
                'villages': {
                    color: '#10B981',
                    weight: 2.5,
                    opacity: 1,
                    fillColor: '#10B981',
                    fillOpacity: 0.4
                },
                'tribal_areas': {
                    color: '#DC2626',
                    weight: 3.5,
                    opacity: 1,
                    fillColor: '#DC2626',
                    fillOpacity: 0.5
                }
            };
            return styles[layerType] || styles['states'];
        }

        // FRA Atlas Layer Management
        let fraLayers = {};
        
        async function toggleFRALayer(layerType) {
            const button = document.getElementById(layerType + '-layer');
            const isActive = button.classList.contains('active');
            
            if (isActive) {
                // Remove layer
                if (fraLayers[layerType]) {
                    window.fraAtlas.map.removeLayer(fraLayers[layerType]);
                    delete fraLayers[layerType];
                }
                button.classList.remove('active');
            } else {
                // Add FRA layer
                try {
                    const layer = await createFRALayer(layerType);
                    layer.addTo(window.fraAtlas.map);
                    fraLayers[layerType] = layer;
                    button.classList.add('active');
                    
                    console.log(`‚úÖ ${layerType} FRA layer loaded`);
                } catch (error) {
                    console.error(`‚ùå Failed to load ${layerType} FRA layer:`, error);
                }
            }
        }
        
        async function createFRALayer(layerType) {
            const layerStyles = {
                'claims': {
                    color: '#FF6B35',
                    weight: 2,
                    opacity: 0.8,
                    fillColor: '#FF6B35',
                    fillOpacity: 0.3,
                    radius: 8
                },
                'forest': {
                    color: '#228B22',
                    weight: 1,
                    opacity: 0.6,
                    fillColor: '#228B22',
                    fillOpacity: 0.4
                },
                'water': {
                    color: '#4169E1',
                    weight: 1,
                    opacity: 0.7,
                    fillColor: '#4169E1',
                    fillOpacity: 0.5
                },
                'agricultural': {
                    color: '#FFD700',
                    weight: 1,
                    opacity: 0.6,
                    fillColor: '#FFD700',
                    fillOpacity: 0.3
                }
            };
            
            const style = layerStyles[layerType];
            const layerGroup = L.layerGroup();
            
            // Load FRA data and create markers/polygons
            const response = await fetch('/api/fra-atlas/states');
            const data = await response.json();
            
            for (const state of data.states) {
                // Create markers for each state with FRA data
                const marker = L.circleMarker([21.8225, 75.6102], {
                    ...style,
                    popup: `${state.name}: ${state.total_pattas} pattas, ${state.total_area_hectares} hectares`
                });
                
                marker.bindPopup(`
                    <div style="font-family: 'Inter', sans-serif; padding: 15px; min-width: 200px;">
                        <h4 style="margin: 0 0 10px 0; color: #1b5e20;">${state.name}</h4>
                        <p style="margin: 5px 0; color: #333;"><strong>Districts:</strong> ${state.districts_count}</p>
                        <p style="margin: 5px 0; color: #333;"><strong>Total Pattas:</strong> ${state.total_pattas}</p>
                        <p style="margin: 5px 0; color: #333;"><strong>Total Area:</strong> ${state.total_area_hectares} hectares</p>
                        <p style="margin: 5px 0; color: #333;"><strong>Forest Cover:</strong> ${state.avg_forest_cover}%</p>
                    </div>
                `);
                
                layerGroup.addLayer(marker);
            }
            
            return layerGroup;
        }

        // Panel Management Functions
        function showDrillDownPanel() {
            hideAllPanels();
            document.getElementById('drill-down-panel').style.display = 'block';
            loadStates();
        }
        
        function hideDrillDownPanel() {
            document.getElementById('drill-down-panel').style.display = 'none';
        }
        
        function showSearchPanel() {
            hideAllPanels();
            document.getElementById('search-panel').style.display = 'block';
        }
        
        function hideSearchPanel() {
            document.getElementById('search-panel').style.display = 'none';
        }
        
        function showFiltersPanel() {
            hideAllPanels();
            document.getElementById('filters-panel').style.display = 'block';
        }
        
        function hideFiltersPanel() {
            document.getElementById('filters-panel').style.display = 'none';
        }
        
        function hideAllPanels() {
            document.getElementById('drill-down-panel').style.display = 'none';
            document.getElementById('search-panel').style.display = 'none';
            document.getElementById('filters-panel').style.display = 'none';
        }

        // Drill-down Navigation Functions
        async function loadStates() {
            try {
                const response = await fetch('/api/fra-atlas/states');
                const data = await response.json();
                
                const content = document.getElementById('navigation-content');
                content.innerHTML = '';
                
                for (const state of data.states) {
                    const item = document.createElement('div');
                    item.className = 'nav-item';
                    item.onclick = () => loadDistricts(state.name);
                    item.innerHTML = `
                        <div class="nav-item-header">${state.name}</div>
                        <div class="nav-item-stats">
                            ${state.districts_count} districts ‚Ä¢ ${state.total_pattas} pattas ‚Ä¢ ${state.total_area_hectares} hectares
                        </div>
                    `;
                    content.appendChild(item);
                }
                
                updateBreadcrumb(['States']);
            } catch (error) {
                console.error('Failed to load states:', error);
            }
        }
        
        async function loadDistricts(stateName) {
            try {
                const response = await fetch(`/api/fra-atlas/states/${encodeURIComponent(stateName)}/districts`);
                const data = await response.json();
                
                const content = document.getElementById('navigation-content');
                content.innerHTML = '';
                
                for (const district of data.districts) {
                    const item = document.createElement('div');
                    item.className = 'nav-item';
                    item.onclick = () => loadBlocks(stateName, district.name);
                    item.innerHTML = `
                        <div class="nav-item-header">${district.name}</div>
                        <div class="nav-item-stats">
                            ${district.blocks_count} blocks ‚Ä¢ ${district.total_pattas} pattas ‚Ä¢ ${district.total_area_hectares} hectares
                        </div>
                    `;
                    content.appendChild(item);
                }
                
                updateBreadcrumb(['States', stateName]);
            } catch (error) {
                console.error('Failed to load districts:', error);
            }
        }
        
        async function loadBlocks(stateName, districtName) {
            try {
                const response = await fetch(`/api/fra-atlas/states/${encodeURIComponent(stateName)}/districts/${encodeURIComponent(districtName)}/blocks`);
                const data = await response.json();
                
                const content = document.getElementById('navigation-content');
                content.innerHTML = '';
                
                for (const block of data.blocks) {
                    const item = document.createElement('div');
                    item.className = 'nav-item';
                    item.onclick = () => loadVillages(stateName, districtName, block.name);
                    item.innerHTML = `
                        <div class="nav-item-header">${block.name}</div>
                        <div class="nav-item-stats">
                            ${block.villages_count} villages ‚Ä¢ ${block.total_pattas} pattas ‚Ä¢ ${block.total_area_hectares} hectares
                        </div>
                    `;
                    content.appendChild(item);
                }
                
                updateBreadcrumb(['States', stateName, districtName]);
            } catch (error) {
                console.error('Failed to load blocks:', error);
            }
        }
        
        async function loadVillages(stateName, districtName, blockName) {
            try {
                const response = await fetch(`/api/fra-atlas/states/${encodeURIComponent(stateName)}/districts/${encodeURIComponent(districtName)}/blocks/${encodeURIComponent(blockName)}/villages`);
                const data = await response.json();
                
                const content = document.getElementById('navigation-content');
                content.innerHTML = '';
                
                for (const village of data.villages) {
                    const item = document.createElement('div');
                    item.className = 'nav-item';
                    item.onclick = () => loadPattaHolders(stateName, districtName, blockName, village.name);
                    item.innerHTML = `
                        <div class="nav-item-header">${village.name}</div>
                        <div class="nav-item-stats">
                            ${village.patta_holders_count} patta holders ‚Ä¢ ${village.total_area_hectares} hectares
                            <br>Forest: ${village.forest_cover_percent}% ‚Ä¢ Water: ${village.water_bodies_count} bodies
                        </div>
                    `;
                    content.appendChild(item);
                }
                
                updateBreadcrumb(['States', stateName, districtName, blockName]);
            } catch (error) {
                console.error('Failed to load villages:', error);
            }
        }
        
        async function loadPattaHolders(stateName, districtName, blockName, villageName) {
            try {
                const response = await fetch(`/api/fra-atlas/states/${encodeURIComponent(stateName)}/districts/${encodeURIComponent(districtName)}/blocks/${encodeURIComponent(blockName)}/villages/${encodeURIComponent(villageName)}/patta-holders`);
                const data = await response.json();
                
                const content = document.getElementById('navigation-content');
                content.innerHTML = '';
                
                for (const patta of data.patta_holders) {
                    const item = document.createElement('div');
                    item.className = 'nav-item';
                    item.innerHTML = `
                        <div class="nav-item-header">${patta.name}</div>
                        <div class="nav-item-stats">
                            ${patta.tribal_group} ‚Ä¢ ${patta.claim_type} ‚Ä¢ ${patta.area_hectares} hectares
                            <br>Status: ${patta.status} ‚Ä¢ Literacy: ${patta.socio_economic.literacy}
                        </div>
                    `;
                    content.appendChild(item);
                }
                
                updateBreadcrumb(['States', stateName, districtName, blockName, villageName]);
            } catch (error) {
                console.error('Failed to load patta holders:', error);
            }
        }
        
        function updateBreadcrumb(path) {
            const breadcrumb = document.getElementById('navigation-breadcrumb');
            breadcrumb.innerHTML = '';
            
            for (let i = 0; i < path.length; i++) {
                const item = document.createElement('span');
                item.className = 'breadcrumb-item';
                if (i === path.length - 1) item.classList.add('active');
                
                const pathArray = path.slice(0, i + 1);
                item.onclick = () => {
                    if (pathArray.length === 1) loadStates();
                    else if (pathArray.length === 2) loadDistricts(pathArray[1]);
                    else if (pathArray.length === 3) loadBlocks(pathArray[1], pathArray[2]);
                    else if (pathArray.length === 4) loadVillages(pathArray[1], pathArray[2], pathArray[3]);
                };
                
                item.textContent = path[i];
                breadcrumb.appendChild(item);
            }
        }

        // Search Functions
        async function performSearch() {
            const query = document.getElementById('search-input').value;
            const statusFilter = document.getElementById('status-filter').value;
            const typeFilter = document.getElementById('type-filter').value;
            
            if (query.length < 2) {
                document.getElementById('search-results').innerHTML = '';
                return;
            }
            
            try {
                const params = new URLSearchParams({
                    q: query,
                    status: statusFilter,
                    type: typeFilter
                });
                
                const response = await fetch(`/api/fra-atlas/search?${params}`);
                const data = await response.json();
                
                displaySearchResults(data.results);
            } catch (error) {
                console.error('Search failed:', error);
            }
        }
        
        function displaySearchResults(results) {
            const container = document.getElementById('search-results');
            container.innerHTML = '';
            
            if (results.length === 0) {
                container.innerHTML = '<div style="text-align: center; color: #666; padding: 20px;">No results found</div>';
                return;
            }
            
            for (const result of results) {
                const item = document.createElement('div');
                item.className = 'search-result-item';
                item.onclick = () => {
                    // Center map on result coordinates
                    window.fraAtlas.map.setView(result.coordinates, 12);
                    hideSearchPanel();
                };
                
                item.innerHTML = `
                    <div class="search-result-header">${result.patta_holder}</div>
                    <div class="search-result-details">
                        ${result.village}, ${result.block}, ${result.district}, ${result.state}
                        <br>${result.tribal_group} ‚Ä¢ ${result.claim_type} ‚Ä¢ ${result.area_hectares} hectares ‚Ä¢ ${result.status}
                    </div>
                `;
                
                container.appendChild(item);
            }
        }

        // Filter Functions
        function updateClaimStatusFilter() {
            console.log('Claim status filter updated');
            // Implement filter logic
        }
        
        // Layer toggle state
        let activeLayers = {
            ifr: true,
            cr: true,
            cfr: true,
            tribal: true,
            boundaries: true
        };

        function updateClaimTypeFilter() {
            const ifrCheckbox = document.querySelector('input[type="checkbox"]:nth-of-type(1)');
            const crCheckbox = document.querySelector('input[type="checkbox"]:nth-of-type(2)');
            const cfrCheckbox = document.querySelector('input[type="checkbox"]:nth-of-type(3)');
            
            activeLayers.ifr = ifrCheckbox.checked;
            activeLayers.cr = crCheckbox.checked;
            activeLayers.cfr = cfrCheckbox.checked;
            
            console.log('Claim type filter updated:', activeLayers);
            refreshMapLayers();
        }
        
        function updateTribalGroupFilter() {
            const tribalCheckboxes = document.querySelectorAll('input[type="checkbox"]');
            const tribalChecked = Array.from(tribalCheckboxes).slice(3, 6).some(cb => cb.checked);
            activeLayers.tribal = tribalChecked;
            
            console.log('Tribal group filter updated:', activeLayers);
            refreshMapLayers();
        }
        
        function updateAreaFilter() {
            const value = document.getElementById('area-range').value;
            document.getElementById('area-value').textContent = `0-${value} hectares`;
            console.log('Area filter updated:', value);
            refreshMapLayers();
        }

        function refreshMapLayers() {
            // Refresh map layers based on active filters
            if (window.map) {
                // Clear existing layers
                window.map.eachLayer(function(layer) {
                    if (layer.options && layer.options.layerType) {
                        window.map.removeLayer(layer);
                    }
                });
                
                // Re-add active layers
                if (activeLayers.ifr) {
                    toggleFRALayer('IFR');
                }
                if (activeLayers.cr) {
                    toggleFRALayer('CR');
                }
                if (activeLayers.cfr) {
                    toggleFRALayer('CFR');
                }
                if (activeLayers.boundaries) {
                    toggleBoundaryLayer('states');
                }
            }
        }

        // Asset layer management
        let assetLayers = {
            agriculture: null,
            forest: null,
            water: null,
            homestead: null,
            groundwater: null,
            pmgs: null
        };

        function toggleAssetLayer(layerType) {
            if (!window.map) return;

            const checkbox = document.querySelector(`input[onchange*="${layerType}"]`);
            const isChecked = checkbox.checked;

            if (assetLayers[layerType]) {
                window.map.removeLayer(assetLayers[layerType]);
                assetLayers[layerType] = null;
            }

            if (isChecked) {
                assetLayers[layerType] = createAssetLayer(layerType);
                if (assetLayers[layerType]) {
                    window.map.addLayer(assetLayers[layerType]);
                }
            }
        }

        function createAssetLayer(layerType) {
            const colors = {
                agriculture: '#8BC34A',
                forest: '#4CAF50',
                water: '#2196F3',
                homestead: '#FF9800',
                groundwater: '#00BCD4',
                pmgs: '#9C27B0'
            };

            const opacity = 0.6;
            const color = colors[layerType] || '#666666';

            // Create mock GeoJSON data for demo
            const mockData = {
                type: 'FeatureCollection',
                features: [
                    {
                        type: 'Feature',
                        properties: {
                            type: layerType,
                            confidence: Math.random() * 0.3 + 0.7, // 70-100% confidence
                            area: Math.random() * 100 + 10
                        },
                        geometry: {
                            type: 'Polygon',
                            coordinates: [[
                                [80.0, 22.0],
                                [80.1, 22.0],
                                [80.1, 22.1],
                                [80.0, 22.1],
                                [80.0, 22.0]
                            ]]
                        }
                    }
                ]
            };

            return L.geoJSON(mockData, {
                style: function(feature) {
                    return {
                        fillColor: color,
                        weight: 2,
                        opacity: 1,
                        color: color,
                        fillOpacity: opacity
                    };
                },
                onEachFeature: function(feature, layer) {
                    const props = feature.properties;
                    layer.bindPopup(`
                        <div class="asset-popup">
                            <h4>${layerType.charAt(0).toUpperCase() + layerType.slice(1)} Asset</h4>
                            <p><strong>Confidence:</strong> ${props.confidence ? (props.confidence * 100).toFixed(1) : 'N/A'}%</p>
                            <p><strong>Area:</strong> ${props.area ? props.area.toFixed(1) : 'N/A'} hectares</p>
                            <p><strong>Type:</strong> ${props.type || 'Unknown'}</p>
                        </div>
                    `);
                },
                layerType: 'asset',
                assetType: layerType
            });
        }

        // Export functionality
        function exportAtlasData(format) {
            const scope = getCurrentScope();
            const url = `/api/export/atlas?format=${format}&scope=${scope}`;
            
            // Create temporary link and trigger download
            const link = document.createElement('a');
            link.href = url;
            link.download = `fra_atlas_${scope}_${new Date().toISOString().split('T')[0]}.${format === 'geojson' ? 'geojson' : 'csv'}`;
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }

        function exportProgressData() {
            const scope = getCurrentScope();
            const url = `/api/export/progress?scope=${scope}`;
            
            // Create temporary link and trigger download
            const link = document.createElement('a');
            link.href = url;
            link.download = `fra_progress_${scope}_${new Date().toISOString().split('T')[0]}.csv`;
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }

        function getCurrentScope() {
            // Get current scope from breadcrumb or default to 'all'
            const breadcrumb = document.getElementById('breadcrumbNav');
            if (breadcrumb) {
                const activeItem = breadcrumb.querySelector('.breadcrumb-item.active');
                if (activeItem) {
                    return activeItem.dataset.scope || 'all';
                }
            }
            return 'all';
        }

        // MPR Snapshot functionality
        async function loadMPRSnapshot() {
            try {
                const response = await fetch('/api/mpr/snapshot');
                const data = await response.json();
                
                if (data.error) {
                    document.getElementById('mprSnapshotData').innerHTML = '<p>Error loading MPR data</p>';
                    return;
                }
                
                // Get current language consistently
                const currentLang = getCurrentLanguage();
                
                // Get translations for current language
                const t = translations[currentLang] || translations['en'];
                
                const mprData = data.data;
                const totalRecords = data.metadata.total_records;
                const states = data.metadata.states;
                
                // Calculate summary statistics
                const totalIFR = mprData.reduce((sum, row) => sum + parseInt(row.ifr_filed || 0), 0);
                const totalCR = mprData.reduce((sum, row) => sum + parseInt(row.cr_filed || 0), 0);
                const totalCFR = mprData.reduce((sum, row) => sum + parseInt(row.cfr_filed || 0), 0);
                const totalGranted = mprData.reduce((sum, row) => sum + parseInt(row.ifr_granted || 0) + parseInt(row.cr_granted || 0) + parseInt(row.cfr_granted || 0), 0);
                const totalArea = mprData.reduce((sum, row) => sum + parseFloat(row.total_area_vested || 0), 0);
                
                document.getElementById('mprSnapshotData').innerHTML = `
                    <p><strong>${t.states || 'States'}:</strong> ${states.length}</p>
                    <p><strong>${t.total_claims || 'Total Claims'}:</strong> ${totalIFR + totalCR + totalCFR}</p>
                    <p><strong>${t.granted || 'Granted'}:</strong> ${totalGranted}</p>
                    <p><strong>${t.area_vested || 'Area Vested'}:</strong> ${totalArea.toFixed(1)} ha</p>
                    <p><strong>${t.last_updated || 'Last Updated'}:</strong> ${new Date().toLocaleDateString()}</p>
                `;
                
            } catch (error) {
                console.error('Error loading MPR snapshot:', error);
                document.getElementById('mprSnapshotData').innerHTML = '<p>Error loading MPR data</p>';
            }
        }

        // Load MPR snapshot on page load and initialize language
        document.addEventListener('DOMContentLoaded', function() {
            loadMPRSnapshot();
            
            // Initialize language on page load
            const currentLang = getCurrentLanguage();
            currentGlobalLanguage = currentLang;
            
            if (currentLang !== 'en') {
                console.log('üîÑ Initializing language on page load:', currentLang);
                const langTranslations = translations[currentLang] || translations['en'];
                updateAllElements(langTranslations);
                forceReloadAllContent(langTranslations);
            }
        });

        // Chatbot functionality
        let chatbotOpen = false;
        
        function toggleChatbot() {
            const container = document.getElementById('chatbot-container');
            chatbotOpen = !chatbotOpen;
            
            if (chatbotOpen) {
                container.classList.add('open');
                document.getElementById('chatbot-input').focus();
            } else {
                container.classList.remove('open');
            }
        }
        
        async function sendMessage() {
            const input = document.getElementById('chatbot-input');
            const message = input.value.trim();
            
            if (!message) return;
            
            addMessage(message, 'user');
            input.value = '';
            showTyping();
            
            try {
                // Simulate API call (replace with real chatbot API)
                await new Promise(resolve => setTimeout(resolve, 1000));
                
                removeTyping();
                
                // Mock responses based on message content
                let response = "I understand your question about FRA. Let me help you with that information.";
                let suggestions = ["Tell me more", "Show village data", "Available schemes"];
                
                if (message.toLowerCase().includes('fra')) {
                    response = "The Forest Rights Act (FRA) 2006 recognizes the rights of forest-dwelling communities over land and forest resources. It covers Individual Forest Rights (IFR), Community Rights (CR), and Community Forest Resource Rights (CFR).";
                    suggestions = ["What schemes are available?", "Show eligibility criteria", "Village analysis"];
                } else if (message.toLowerCase().includes('scheme')) {
                    response = "Available schemes include PM-KISAN (‚Çπ6,000 annual), Jal Shakti Mission (water infrastructure), MGNREGA (employment guarantee), DAJGUA (tribal development), and Van Dhan Vikas (forest produce marketing).";
                    suggestions = ["Check eligibility", "View village recommendations", "Export data"];
                } else if (message.toLowerCase().includes('village') || message.toLowerCase().includes('khargone')) {
                    response = "Khargone village has 2.5 hectares of approved FRA land under Ram Singh. The land analysis shows 35.5% farmland and 42.3% forest cover, making it eligible for multiple government schemes.";
                    suggestions = ["Show recommendations", "View on map", "Generate report"];
                }
                
                addMessage(response, 'bot');
                addSuggestions(suggestions);
                
            } catch (error) {
                removeTyping();
                addMessage("Sorry, I'm having trouble connecting right now. Please try again later.", 'bot');
            }
        }
        
        function sendSuggestion(suggestion) {
            document.getElementById('chatbot-input').value = suggestion;
            sendMessage();
        }
        
        function addMessage(text, sender) {
            const messagesContainer = document.getElementById('chatbot-messages');
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${sender}-message`;
            
            const avatar = sender === 'bot' ? 'ü§ñ' : 'üë§';
            
            messageDiv.innerHTML = `
                <div class="message-avatar">${avatar}</div>
                <div class="message-content">
                    <p>${text}</p>
                </div>
            `;
            
            messagesContainer.appendChild(messageDiv);
            messagesContainer.scrollTop = messagesContainer.scrollHeight;
        }
        
        function addSuggestions(suggestions) {
            const messagesContainer = document.getElementById('chatbot-messages');
            const suggestionsDiv = document.createElement('div');
            suggestionsDiv.className = 'message bot-message';
            
            const suggestionsHTML = suggestions.map(suggestion => 
                `<button class="suggestion-btn" onclick="sendSuggestion('${suggestion}')">${suggestion}</button>`
            ).join('');
            
            suggestionsDiv.innerHTML = `
                <div class="message-avatar">ü§ñ</div>
                <div class="message-content">
                    <p>You might also want to ask:</p>
                    <div class="suggestion-buttons">${suggestionsHTML}</div>
                </div>
            `;
            
            messagesContainer.appendChild(suggestionsDiv);
            messagesContainer.scrollTop = messagesContainer.scrollHeight;
        }
        
        function showTyping() {
            const messagesContainer = document.getElementById('chatbot-messages');
            const typingDiv = document.createElement('div');
            typingDiv.className = 'message bot-message';
            typingDiv.id = 'typing-indicator';
            
            typingDiv.innerHTML = `
                <div class="message-avatar">ü§ñ</div>
                <div class="message-content">
                    <p>Thinking...</p>
                </div>
            `;
            
            messagesContainer.appendChild(typingDiv);
            messagesContainer.scrollTop = messagesContainer.scrollHeight;
        }
        
        function removeTyping() {
            const typingIndicator = document.getElementById('typing-indicator');
            if (typingIndicator) {
                typingIndicator.remove();
            }
        }
        
        // Handle Enter key in chatbot input
        document.addEventListener('DOMContentLoaded', function() {
            const input = document.getElementById('chatbot-input');
            if (input) {
                input.addEventListener('keypress', function(e) {
                    if (e.key === 'Enter') {
                        sendMessage();
                    }
                });
            }
        });

        // Initialize when page loads
        let fraAtlas;
        document.addEventListener('DOMContentLoaded', () => {
            console.log('üöÄ FRA Atlas Ultimate loaded, starting system...');
            fraAtlas = new FRAAtlas();
            window.fraAtlas = fraAtlas;
        });

        // Global function to force update village information translations
        window.updateVillageTranslations = async function() {
            if (fraAtlas) {
                await fraAtlas.forceUpdateVillageInfo();
                console.log('‚úÖ Village information translations updated!');
            } else {
                console.error('‚ùå FRA Atlas not initialized yet');
            }
        };

        // Global function to force update all translations
        window.updateAllTranslations = async function() {
            if (fraAtlas) {
                await fraAtlas.forceUpdateVillageInfo();
                console.log('‚úÖ All translations updated!');
            } else {
                console.error('‚ùå FRA Atlas not initialized yet');
            }
        };

        // Global function to force all content to use same language
        window.forceSameLanguage = function() {
            const currentLang = getCurrentLanguage();
            const t = translations[currentLang] || translations['en'];
            console.log('üîÑ Forcing all content to use language:', currentLang);
            
            // Update all elements
            updateAllElements(t);
            
            // Force reload all content
            forceReloadAllContent(t);
            
            // Force complete regeneration
            forceCompleteRegeneration(t);
            
            console.log('‚úÖ All content forced to use same language!');
        };

        // Global function to manually change language
        window.changeLanguageManually = function(lang) {
            console.log('üîÑ Manually changing language to:', lang);
            
            // Set global language state
            currentGlobalLanguage = lang;
            
            // Set cookie
            document.cookie = `lang=${lang}; path=/; max-age=${60*60*24*365}`;
            
            // Store in sessionStorage
            sessionStorage.setItem('currentLanguage', lang);
            
            // Update language selector
            const selector = document.getElementById('language-select');
            if (selector) {
                selector.value = lang;
            }
            
            // Get translations
            const t = translations[lang] || translations['en'];
            
            // Update all elements
            updateAllElements(t);
            
            // Force complete regeneration
            forceCompleteRegeneration(t);
            
            console.log('‚úÖ Language manually changed to:', lang);
        };

        // Global function to force all content to English
        window.forceEnglish = function() {
            console.log('üîÑ Forcing all content to English');
            changeLanguageManually('en');
        };

        // Global function to force all content to Hindi
        window.forceHindi = function() {
            console.log('üîÑ Forcing all content to Hindi');
            changeLanguageManually('hi');
        };

        // Global function to force all content to Tamil
        window.forceTamil = function() {
            console.log('üîÑ Forcing all content to Tamil');
            changeLanguageManually('ta');
        };

        // Global function to completely reset and regenerate all content
        window.resetAllContent = function(lang = 'en') {
            console.log('üîÑ Completely resetting all content to language:', lang);
            
            // Set global language state
            currentGlobalLanguage = lang;
            
            // Set cookie
            document.cookie = `lang=${lang}; path=/; max-age=${60*60*24*365}`;
            
            // Store in sessionStorage
            sessionStorage.setItem('currentLanguage', lang);
            
            // Update language selector
            const selector = document.getElementById('language-select');
            if (selector) {
                selector.value = lang;
            }
            
            // Get translations
            const t = translations[lang] || translations['en'];
            
            // Clear all content first
            const villageContainer = document.getElementById('village-info');
            if (villageContainer) {
                villageContainer.innerHTML = '<div class="loading">Loading...</div>';
            }
            
            const statsContainer = document.getElementById('land-stats');
            if (statsContainer) {
                statsContainer.innerHTML = '<div class="loading">Loading...</div>';
            }
            
            const mprContainer = document.getElementById('mprSnapshotData');
            if (mprContainer) {
                mprContainer.innerHTML = '<div class="loading">Loading...</div>';
            }
            
            // Wait a moment then regenerate
            setTimeout(() => {
                // Update all elements
                updateAllElements(t);
                
                // Force complete regeneration
                forceCompleteRegeneration(t);
                
                console.log('‚úÖ All content completely reset and regenerated');
            }, 500);
        };

        // Direct language fix - bypasses all existing systems
        window.fixLanguage = function(lang = 'en') {
            console.log('üîÑ Direct language fix to:', lang);
            
            // Set global language state
            currentGlobalLanguage = lang;
            
            // Set cookie
            document.cookie = `lang=${lang}; path=/; max-age=${60*60*24*365}`;
            
            // Store in sessionStorage
            sessionStorage.setItem('currentLanguage', lang);
            
            // Update language selector
            const selector = document.getElementById('language-select');
            if (selector) {
                selector.value = lang;
            }
            
            // Get translations
            const t = translations[lang] || translations['en'];
            
            // Directly replace all content with correct language
            const villageContainer = document.getElementById('village-info');
            if (villageContainer) {
                villageContainer.innerHTML = `
                    <div class="village-card">
                        <div class="village-header">
                            <div class="village-avatar">üèòÔ∏è</div>
                            <div class="village-details">
                                <h3>Khargone</h3>
                                <p>${t.forest_rights_village || 'Forest Rights Village'} ‚Ä¢ ${t.approved || 'Approved'}</p>
                            </div>
                        </div>
                        
                        <div style="display: grid; gap: 14px;">
                            <div class="stat-item">
                                <span class="stat-label">
                                    <span>üë§</span> ${t.patta_holder || 'Patta Holder'}
                                </span>
                                <span class="stat-value">Ram Singh</span>
                            </div>
                            <div class="stat-item">
                                <span class="stat-label">
                                    <span>üìè</span> ${t.land_area || 'Land Area'}
                                </span>
                                <span class="stat-value">2.5 ${t.hectares || 'ha'}</span>
                            </div>
                            <div class="stat-item">
                                <span class="stat-label">
                                    <span>‚úÖ</span> ${t.claim_status || 'Claim Status'}
                                </span>
                                <span class="stat-value" style="color: #28a745;">${t.approved || 'Approved'}</span>
                            </div>
                            <div class="stat-item">
                                <span class="stat-label">
                                    <span>üìç</span> ${t.location || 'Coordinates'}
                                </span>
                                <span class="stat-value">21.8225, 75.6102</span>
                            </div>
                        </div>
                    </div>
                `;
            }
            
            // Directly replace statistics with correct language
            const statsContainer = document.getElementById('land-stats');
            if (statsContainer) {
                statsContainer.innerHTML = `
                    <div class="stats-grid">
                        <div class="stat-item" style="animation: slideUp 0.5s ease 0s both;">
                            <div class="stat-label">
                                <span class="stat-icon">üåæ</span>
                                <span>${t.farmland || 'Farmland'}</span>
                            </div>
                            <div class="stat-value-container">
                                <div class="stat-value">35.5%</div>
                                <div class="stat-subtext">3,550 ${t.pixels || 'pixels'}</div>
                            </div>
                        </div>
                        <div class="stat-item" style="animation: slideUp 0.5s ease 0.1s both;">
                            <div class="stat-label">
                                <span class="stat-icon">üå≤</span>
                                <span>${t.forest || 'Forest'}</span>
                            </div>
                            <div class="stat-value-container">
                                <div class="stat-value">42.3%</div>
                                <div class="stat-subtext">4,230 ${t.pixels || 'pixels'}</div>
                            </div>
                        </div>
                        <div class="stat-item" style="animation: slideUp 0.5s ease 0.2s both;">
                            <div class="stat-label">
                                <span class="stat-icon">üè†</span>
                                <span>${t.homestead || 'Homestead'}</span>
                            </div>
                            <div class="stat-value-container">
                                <div class="stat-value">14.4%</div>
                                <div class="stat-subtext">1,440 ${t.pixels || 'pixels'}</div>
                            </div>
                        </div>
                        <div class="stat-item" style="animation: slideUp 0.5s ease 0.3s both;">
                            <div class="stat-label">
                                <span class="stat-icon">üíß</span>
                                <span>${t.water || 'Water'}</span>
                            </div>
                            <div class="stat-value-container">
                                <div class="stat-value">7.8%</div>
                                <div class="stat-subtext">780 ${t.pixels || 'pixels'}</div>
                            </div>
                        </div>
                    </div>
                `;
            }
            
            // Update all other elements
            updateAllElements(t);
            
            console.log('‚úÖ Direct language fix completed');
        };
    </script>
</body>
{% endblock %}
