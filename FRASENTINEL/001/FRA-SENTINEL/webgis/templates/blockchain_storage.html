<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FRA Sentinel - Blockchain Storage</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        :root {
            --primary-gradient: linear-gradient(135deg, #0d4f3c 0%, #1b5e20 25%, #2e7d32 50%, #4caf50 75%, #81c784 100%);
            --blockchain-gradient: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            --text-primary: #1a1a1a;
            --text-secondary: #2e7d32;
            --border-radius: 16px;
            --shadow: 0 8px 32px rgba(13, 79, 60, 0.08);
            --spacing-md: 16px;
            --spacing-lg: 24px;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(135deg, #f1f8e9 0%, #e8f5e8 100%);
            min-height: 100vh;
        }
        
        .header {
            background: var(--blockchain-gradient);
            color: white;
            padding: var(--spacing-lg);
            text-align: center;
            position: relative;
            overflow: hidden;
            box-shadow: var(--shadow);
        }
        
        .header-content h1 {
            font-size: 2.5rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
        }

        .header-controls {
            position: absolute;
            top: 50%;
            right: var(--spacing-lg);
            transform: translateY(-50%);
            display: flex;
            gap: 10px;
        }

        .back-button {
            position: absolute;
            top: var(--spacing-lg);
            left: var(--spacing-lg);
            background: rgba(255,255,255,0.2);
            color: white;
            padding: 8px 16px;
            border-radius: 6px;
            text-decoration: none;
            font-weight: 500;
        }

        .back-button:hover {
            background: rgba(255,255,255,0.3);
            color: white;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: var(--spacing-lg);
        }

        .blockchain-card {
            background: white;
            border-radius: var(--border-radius);
            padding: var(--spacing-lg);
            box-shadow: var(--shadow);
            margin-bottom: var(--spacing-lg);
        }

        .blockchain-card h2 {
            color: var(--text-secondary);
            margin-bottom: var(--spacing-md);
            font-size: 1.5rem;
            font-weight: 600;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: var(--spacing-md);
            margin-bottom: var(--spacing-lg);
        }

        .stat-card {
            background: var(--blockchain-gradient);
            color: white;
            padding: var(--spacing-md);
            border-radius: var(--border-radius);
            text-align: center;
        }

        .stat-number {
            font-size: 2rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
        }

        .stat-label {
            font-size: 0.9rem;
            opacity: 0.9;
        }

        .action-buttons {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: var(--spacing-md);
            margin-bottom: var(--spacing-lg);
        }

        .action-button {
            background: var(--primary-gradient);
            color: white;
            padding: var(--spacing-md);
            border: none;
            border-radius: var(--border-radius);
            font-size: 1rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }
        
        .action-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(13, 79, 60, 0.2);
            color: white;
        }

        .action-button.secondary {
            background: linear-gradient(135deg, #2196f3 0%, #64b5f6 100%);
        }

        .action-button.tertiary {
            background: linear-gradient(135deg, #ff9800 0%, #ffb74d 100%);
        }

        .hash-display {
            font-family: 'Courier New', monospace;
            background: #f8f9fa;
            padding: 10px;
            border-radius: 5px;
            word-break: break-all;
            font-size: 12px;
            border: 1px solid #e0e0e0;
        }

        .transaction-item {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 10px;
            border-left: 4px solid #4caf50;
        }

        .transaction-item.verification {
            border-left-color: #2196f3;
        }

        .transaction-item.rejected {
            border-left-color: #f44336;
        }

        .form-group {
            margin-bottom: 15px;
        }

        .form-label {
            font-weight: 600;
            margin-bottom: 5px;
            display: block;
        }

        .form-control {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 14px;
        }

        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-weight: 500;
        }

        .btn-primary {
            background: var(--primary-gradient);
            color: white;
        }

        .btn-success {
            background: #4caf50;
            color: white;
        }

        .btn-danger {
            background: #f44336;
            color: white;
        }

        .alert {
            padding: 15px;
            border-radius: 5px;
            margin-bottom: 15px;
        }

        .alert-success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .alert-danger {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        .search-results {
            max-height: 400px;
            overflow-y: auto;
        }

        .result-item {
            background: white;
            padding: 10px;
            border-radius: 5px;
            margin-bottom: 5px;
            border: 1px solid #e0e0e0;
        }

        .verified-badge {
            background: #4caf50;
            color: white;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 500;
        }

        .pending-badge {
            background: #ff9800;
            color: white;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 500;
        }

        @media (max-width: 768px) {
            .header-controls {
                position: static;
                transform: none;
                justify-content: center;
                margin-top: var(--spacing-md);
            }
            
            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .action-buttons {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <!-- Blockchain Header -->
    <header class="header">
        <a href="{{ url_for('admin_dashboard') }}" class="back-button">‚Üê Back to Admin</a>
        <div class="header-content">
            <h1><i class="fas fa-link"></i> Blockchain Storage</h1>
            <p>Immutable Document Verification for Forest Rights Act</p>
        </div>
        <div class="header-controls">
            <a href="{{ url_for('logout') }}" style="background: rgba(255,255,255,0.2); color: white; padding: 8px 16px; border-radius: 6px; text-decoration: none;">
                üö™ Logout
            </a>
        </div>
    </header>

    <div class="container">
        <!-- Blockchain Statistics -->
        <div class="blockchain-card">
            <h2><i class="fas fa-chart-bar"></i> Blockchain Network Statistics</h2>
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-number" id="totalDocs">0</div>
                    <div class="stat-label">Documents Registered</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="totalTx">0</div>
                    <div class="stat-label">Total Transactions</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="verifiedDocs">0</div>
                    <div class="stat-label">Verified Documents</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="blockNum">18,456,789</div>
                    <div class="stat-label">Current Block</div>
                </div>
            </div>
        </div>

        <!-- Quick Actions -->
        <div class="blockchain-card">
            <h2><i class="fas fa-bolt"></i> Quick Actions</h2>
            <div class="action-buttons">
                <button class="action-button" onclick="showRegisterForm()">
                    <i class="fas fa-upload"></i>
                    Register Document
                </button>
                <button class="action-button secondary" onclick="showVerifyForm()">
                    <i class="fas fa-check-circle"></i>
                    Verify Document
                </button>
                <button class="action-button tertiary" onclick="showSearchForm()">
                    <i class="fas fa-search"></i>
                    Search Documents
                </button>
                <button class="action-button" onclick="loadTransactions()">
                    <i class="fas fa-list"></i>
                    View Transactions
                </button>
            </div>
        </div>

        <!-- Register Document Form -->
        <div class="blockchain-card" id="registerForm" style="display: none;">
            <h2><i class="fas fa-upload"></i> Register Document on Blockchain</h2>
            <form id="registerDocumentForm">
                <div class="form-group">
                    <label class="form-label">Patta Holder Name</label>
                    <input type="text" class="form-control" id="holderName" required>
                </div>
                <div class="form-group">
                    <label class="form-label">Village</label>
                    <input type="text" class="form-control" id="village" required>
                </div>
                <div class="form-group">
                    <label class="form-label">District</label>
                    <input type="text" class="form-control" id="district" required>
                </div>
                <div class="form-group">
                    <label class="form-label">State</label>
                    <input type="text" class="form-control" id="state" required>
                </div>
                <div class="form-group">
                    <label class="form-label">Area (Hectares)</label>
                    <input type="number" step="0.01" class="form-control" id="area" required>
                </div>
                <div class="form-group">
                    <label class="form-label">Survey Number</label>
                    <input type="text" class="form-control" id="surveyNumber">
                </div>
                <button type="submit" class="btn btn-primary">
                    <i class="fas fa-link"></i> Register on Blockchain
                </button>
            </form>
            
            <div id="registerResult" style="display: none; margin-top: 20px;"></div>
        </div>

        <!-- Verify Document Form -->
        <div class="blockchain-card" id="verifyForm" style="display: none;">
            <h2><i class="fas fa-check-circle"></i> Verify Document</h2>
            <form id="verifyDocumentForm">
                <div class="form-group">
                    <label class="form-label">Document Hash</label>
                    <input type="text" class="form-control" id="verifyHash" placeholder="Enter document hash">
                </div>
                <div class="form-group">
                    <label class="form-label">Verification Notes</label>
                    <textarea class="form-control" id="verifyNotes" rows="3">Document verified by authorized officer</textarea>
                </div>
                <div class="form-group">
                    <label class="form-label">
                        <input type="checkbox" id="isValid" checked> Document is Valid
                    </label>
                </div>
                <button type="submit" class="btn btn-success">
                    <i class="fas fa-check"></i> Verify Document
                </button>
            </form>
            
            <div id="verifyResult" style="display: none; margin-top: 20px;"></div>
        </div>

        <!-- Search Documents Form -->
        <div class="blockchain-card" id="searchForm" style="display: none;">
            <h2><i class="fas fa-search"></i> Search Documents</h2>
            <form id="searchDocumentsForm">
                <div class="form-group">
                    <label class="form-label">Search Query</label>
                    <input type="text" class="form-control" id="searchQuery" placeholder="Search by holder name, village, or district">
                </div>
                <button type="submit" class="btn btn-primary">
                    <i class="fas fa-search"></i> Search
                </button>
            </form>
            
            <div id="searchResults" style="display: none; margin-top: 20px;"></div>
        </div>

        <!-- Recent Transactions -->
        <div class="blockchain-card">
            <h2><i class="fas fa-list"></i> Recent Blockchain Transactions</h2>
            <div id="transactionsList">
                <p class="text-muted">Loading transactions...</p>
            </div>
            <button class="btn btn-primary" onclick="loadTransactions()">
                <i class="fas fa-sync"></i> Refresh Transactions
            </button>
        </div>

        <!-- Blockchain Benefits -->
        <div class="blockchain-card">
            <h2><i class="fas fa-shield-alt"></i> Blockchain Benefits</h2>
            <div class="row">
                <div class="col-md-6">
                    <ul class="list-unstyled">
                        <li><i class="fas fa-check text-success"></i> <strong>Immutable Records:</strong> Cannot be altered once recorded</li>
                        <li><i class="fas fa-check text-success"></i> <strong>Transparency:</strong> All transactions are publicly verifiable</li>
                        <li><i class="fas fa-check text-success"></i> <strong>Security:</strong> SHA-256 cryptographic protection</li>
                    </ul>
                </div>
                <div class="col-md-6">
                    <ul class="list-unstyled">
                        <li><i class="fas fa-check text-success"></i> <strong>Audit Trail:</strong> Complete history of all changes</li>
                        <li><i class="fas fa-check text-success"></i> <strong>Decentralized:</strong> No single point of failure</li>
                        <li><i class="fas fa-check text-success"></i> <strong>Efficiency:</strong> Automated verification processes</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // Load statistics
        async function loadStats() {
            try {
                const response = await fetch('/api/blockchain/stats');
                const data = await response.json();
                
                if (data.success) {
                    document.getElementById('totalDocs').textContent = data.data.total_documents;
                    document.getElementById('totalTx').textContent = data.data.total_transactions;
                    document.getElementById('verifiedDocs').textContent = data.data.verified_documents;
                    document.getElementById('blockNum').textContent = data.data.block_number.toLocaleString();
                }
            } catch (error) {
                console.error('Error loading stats:', error);
            }
        }

        // Load transactions
        async function loadTransactions() {
            try {
                const response = await fetch('/api/blockchain/transactions');
                const data = await response.json();
                
                if (data.success) {
                    const transactionsList = document.getElementById('transactionsList');
                    
                    if (data.transactions.length === 0) {
                        transactionsList.innerHTML = '<p class="text-muted">No transactions yet. Register a document to see transactions.</p>';
                        return;
                    }
                    
                    let html = '';
                    data.transactions.forEach(tx => {
                        const typeClass = tx.type === 'Document Verification' ? 'verification' : '';
                        const statusClass = tx.result === 'Invalid' ? 'rejected' : '';
                        
                        html += `
                            <div class="transaction-item ${typeClass} ${statusClass}">
                                <div class="d-flex justify-content-between align-items-center">
                                    <div>
                                        <h6 class="mb-1">${tx.type}</h6>
                                        <small class="text-muted">${tx.holder} - ${tx.village}</small>
                                        <br>
                                        <small class="text-muted">Block: ${tx.block_number}</small>
                                    </div>
                                    <div class="text-end">
                                        <span class="badge bg-success">${tx.status}</span>
                                        <br>
                                        <small class="text-muted">${new Date(tx.timestamp).toLocaleTimeString()}</small>
                                    </div>
                                </div>
                                <div class="mt-2">
                                    <small class="hash-display">${tx.hash}</small>
                                </div>
                            </div>
                        `;
                    });
                    
                    transactionsList.innerHTML = html;
                }
            } catch (error) {
                console.error('Error loading transactions:', error);
            }
        }

        // Show forms
        function showRegisterForm() {
            hideAllForms();
            document.getElementById('registerForm').style.display = 'block';
        }

        function showVerifyForm() {
            hideAllForms();
            document.getElementById('verifyForm').style.display = 'block';
        }

        function showSearchForm() {
            hideAllForms();
            document.getElementById('searchForm').style.display = 'block';
        }

        function hideAllForms() {
            document.getElementById('registerForm').style.display = 'none';
            document.getElementById('verifyForm').style.display = 'none';
            document.getElementById('searchForm').style.display = 'none';
            document.getElementById('registerResult').style.display = 'none';
            document.getElementById('verifyResult').style.display = 'none';
            document.getElementById('searchResults').style.display = 'none';
        }

        // Register form handler
        document.getElementById('registerDocumentForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const data = {
                holder_name: document.getElementById('holderName').value,
                village_name: document.getElementById('village').value,
                district: document.getElementById('district').value,
                state: document.getElementById('state').value,
                area_claimed: parseFloat(document.getElementById('area').value),
                survey_number: document.getElementById('surveyNumber').value
            };
            
            try {
                const response = await fetch('/api/blockchain/register', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(data)
                });
                
                const result = await response.json();
                
                if (result.success) {
                    let html = '<div class="alert alert-success">';
                    html += '<h5>Document Registered Successfully!</h5>';
                    html += '<p><strong>Document Hash:</strong></p>';
                    html += '<div class="hash-display">' + result.document_hash + '</div>';
                    html += '<p><strong>Transaction Hash:</strong></p>';
                    html += '<div class="hash-display">' + result.transaction_hash + '</div>';
                    html += '<p><strong>Block Number:</strong> ' + result.block_number + '</p>';
                    html += '</div>';
                    
                    document.getElementById('registerResult').innerHTML = html;
                    document.getElementById('registerResult').style.display = 'block';
                    
                    // Update verification form
                    document.getElementById('verifyHash').value = result.document_hash;
                    
                    // Refresh stats and transactions
                    loadStats();
                    loadTransactions();
                } else {
                    document.getElementById('registerResult').innerHTML = '<div class="alert alert-danger"><h5>Registration Failed</h5><p>' + result.error + '</p></div>';
                    document.getElementById('registerResult').style.display = 'block';
                }
            } catch (error) {
                document.getElementById('registerResult').innerHTML = '<div class="alert alert-danger"><h5>Registration Error</h5><p>' + error.message + '</p></div>';
                document.getElementById('registerResult').style.display = 'block';
            }
        });

        // Verify form handler
        document.getElementById('verifyDocumentForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const data = {
                document_hash: document.getElementById('verifyHash').value,
                is_valid: document.getElementById('isValid').checked,
                notes: document.getElementById('verifyNotes').value
            };
            
            try {
                const response = await fetch('/api/blockchain/verify', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(data)
                });
                
                const result = await response.json();
                
                if (result.success) {
                    let html = '<div class="alert alert-success">';
                    html += '<h5>Document Verified Successfully!</h5>';
                    html += '<p><strong>Status:</strong> ' + (data.is_valid ? 'Valid' : 'Invalid') + '</p>';
                    html += '<p><strong>Verification Notes:</strong> ' + data.notes + '</p>';
                    html += '<p><strong>Verification Transaction:</strong></p>';
                    html += '<div class="hash-display">' + result.verification_tx + '</div>';
                    html += '</div>';
                    
                    document.getElementById('verifyResult').innerHTML = html;
                    document.getElementById('verifyResult').style.display = 'block';
                    
                    // Refresh stats and transactions
                    loadStats();
                    loadTransactions();
                } else {
                    document.getElementById('verifyResult').innerHTML = '<div class="alert alert-danger"><h5>Verification Failed</h5><p>' + result.error + '</p></div>';
                    document.getElementById('verifyResult').style.display = 'block';
                }
            } catch (error) {
                document.getElementById('verifyResult').innerHTML = '<div class="alert alert-danger"><h5>Verification Error</h5><p>' + error.message + '</p></div>';
                document.getElementById('verifyResult').style.display = 'block';
            }
        });

        // Search form handler
        document.getElementById('searchDocumentsForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const query = document.getElementById('searchQuery').value;
            
            try {
                const response = await fetch('/api/blockchain/search?query=' + encodeURIComponent(query));
                const result = await response.json();
                
                if (result.success) {
                    let html = '<h5>Search Results (' + result.count + ' found)</h5>';
                    
                    if (result.results.length === 0) {
                        html += '<p class="text-muted">No documents found matching your search.</p>';
                    } else {
                        html += '<div class="search-results">';
                        result.results.forEach(doc => {
                            html += '<div class="result-item">';
                            html += '<div class="d-flex justify-content-between align-items-center">';
                            html += '<div>';
                            html += '<strong>' + doc.holder + '</strong><br>';
                            html += '<small class="text-muted">' + doc.village + ', ' + doc.district + '</small>';
                            html += '</div>';
                            html += '<div class="text-end">';
                            html += '<span class="' + (doc.verified ? 'verified-badge' : 'pending-badge') + '">';
                            html += doc.verified ? 'Verified' : 'Pending';
                            html += '</span><br>';
                            html += '<small class="text-muted">' + new Date(doc.timestamp).toLocaleDateString() + '</small>';
                            html += '</div>';
                            html += '</div>';
                            html += '<div class="mt-2">';
                            html += '<small class="hash-display">' + doc.hash + '</small>';
                            html += '</div>';
                            html += '</div>';
                        });
                        html += '</div>';
                    }
                    
                    document.getElementById('searchResults').innerHTML = html;
                    document.getElementById('searchResults').style.display = 'block';
                } else {
                    document.getElementById('searchResults').innerHTML = '<div class="alert alert-danger"><h5>Search Failed</h5><p>' + result.error + '</p></div>';
                    document.getElementById('searchResults').style.display = 'block';
                }
            } catch (error) {
                document.getElementById('searchResults').innerHTML = '<div class="alert alert-danger"><h5>Search Error</h5><p>' + error.message + '</p></div>';
                document.getElementById('searchResults').style.display = 'block';
            }
        });

        // Initialize page
        document.addEventListener('DOMContentLoaded', function() {
            loadStats();
            loadTransactions();
            
            // Auto-refresh every 30 seconds
            setInterval(() => {
                loadStats();
                loadTransactions();
            }, 30000);
        });
    </script>
</body>
</html>


